import{s as T,aC as E,P as i,p as z,a,j as o,B as R,T as v,b1 as F,F as M,a3 as $}from"./index-BgTNlE3K.js";import{c as B,A as k,C as V}from"./CredentialListDialog-CbgBEUU8.js";import{b as H,A as U,T as Y}from"./TextField-dkTUQuhn.js";import{C as q}from"./Grid-Cq2i7Qbd.js";import{I as G}from"./useNotifier-C3gm9LlJ.js";const J=T(E)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${H.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),K=async({name:r,nodeData:s})=>{var l;const f=(l=s.inputParams.find(c=>c.name===r))==null?void 0:l.loadMethod,g=localStorage.getItem("username"),u=localStorage.getItem("password");return await F.post(`${M}/api/v1/node-load-method/${s.name}`,{...s,loadMethod:f},{auth:g&&u?{username:g,password:u}:void 0}).then(async function(c){return c.data}).catch(function(c){console.error(c)})},L=({name:r,nodeData:s,value:f,onSelect:g,isCreateNewOption:u,onCreateNew:x,credentialNames:l=[],disabled:c=!1,disableClearable:h=!1})=>{const w=z(e=>e.customization),[D,C]=a.useState(!1),[d,y]=a.useState([]),[m,S]=a.useState(!1),A=(e=[],t)=>e.find(p=>p.name===t),N=()=>"",P=[{label:"- Create New -",name:"-create-"}];let[b,I]=a.useState(f??"choose an option");const n=async()=>{try{let e="";l.length>1?e=l.join("&credentialName="):e=l[0];const t=await B.getCredentialsByName(e);if(t.data){const p=[];for(let j=0;j<t.data.length;j+=1){const O={label:t.data[j].name,name:t.data[j].id};p.push(O)}return p}}catch(e){console.error(e)}};return a.useEffect(()=>{S(!0),(async()=>(async()=>{let t=l.length?await n():await K({name:r,nodeData:s});y(u?[...t,...P]:[...t]),S(!1)})())()},[]),o.jsx(o.Fragment,{children:o.jsx(U,{id:r,disabled:c,disableClearable:h,size:"small",sx:{mt:1,width:"100%"},open:D,onOpen:()=>{C(!0)},onClose:()=>{C(!1)},options:d,value:A(d,b)||N(),onChange:(e,t)=>{const p=t?t.name:"";u&&p==="-create-"?x():(I(p),g(p))},PopperComponent:J,loading:m,renderInput:e=>o.jsx(Y,{...e,value:b,InputProps:{...e.InputProps,endAdornment:o.jsxs(a.Fragment,{children:[m?o.jsx(q,{color:"inherit",size:20}):null,e.InputProps.endAdornment]})},sx:{height:"100%","& .MuiInputBase-root":{height:"100%"}}}),renderOption:(e,t)=>o.jsx(R,{component:"li",...e,children:o.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[o.jsx(v,{variant:"h5",children:t.label}),t.description&&o.jsx(v,{sx:{color:w.isDarkMode?"#9e9e9e":""},children:t.description})]})})})})};L.propTypes={name:i.string,nodeData:i.object,value:i.string,onSelect:i.func,onCreateNew:i.func,disabled:i.bool,credentialNames:i.array,disableClearable:i.bool,isCreateNewOption:i.bool};const Q=({inputParam:r,data:s,onSelect:f,disabled:g=!1})=>{const u=a.useRef(null),[x,l]=a.useState((s==null?void 0:s.credential)??""),[c,h]=a.useState(!1),[w,D]=a.useState({}),[C,d]=a.useState(!1),[y,m]=a.useState({}),[S,A]=a.useState(Date.now().toString()),N=n=>{m({type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",credentialId:n}),d(!0)},P=async()=>{try{let n="";r.credentialNames.length>1?n=r.credentialNames.join("&"):n=r.credentialNames[0];const e=await B.getSpecificComponentCredential(n);if(e.data)if(Array.isArray(e.data)){const t={title:"Add New Credential",componentsCredentials:e.data};D(t),h(!0)}else{const t={type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:e.data};m(t),d(!0)}}catch(n){console.error(n)}},b=(n="")=>{l(n),A(Date.now().toString()),m({}),d(!1),f(n)},I=n=>{h(!1),m({type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",credentialComponent:n}),d(!0)};return a.useEffect(()=>{l((s==null?void 0:s.credential)??"")},[s]),o.jsxs("div",{ref:u,children:[r&&o.jsx(o.Fragment,{children:r.type==="credential"&&o.jsxs("div",{style:{display:"flex",flexDirection:"row"},children:[o.jsx(L,{disabled:g,name:r.name,nodeData:s,value:x??"choose an option",isCreateNewOption:!0,credentialNames:r.credentialNames,onSelect:n=>{l(n),f(n)},onCreateNew:()=>P(r.name)}),x&&o.jsx(G,{title:"Edit",color:"primary",size:"small",onClick:()=>N(x),children:o.jsx($,{})})]},S)}),C&&o.jsx(k,{show:C,dialogProps:y,onCancel:()=>d(!1),onConfirm:b}),c&&o.jsx(V,{show:c,dialogProps:w,onCancel:()=>h(!1),onCredentialSelected:I})]})};Q.propTypes={inputParam:i.object,data:i.object,onSelect:i.func,disabled:i.bool};export{L as A,Q as C};
