import{s as le,m as ye,t as _,n as ae,P as n,o as ie,p as be,j as e,v as Ce,w as we,x as Te,y as ke,z as ve,T,C as ee,E as Se,a as i,F as Be,M as Fe,K as L,G as De,I as Ie,B as k,J as te}from"./index-BgTNlE3K.js";import{I as v}from"./ItemCard-C3XUgP8C.js";import{T as Me,W as Pe}from"./workflow_empty-Dwp_c8Jm.js";import{C as R,B as Le,T as Re}from"./ToolDialog-A8-wxjvs.js";import{b as $,B as Oe,u as ze,S as se,O,T as re}from"./useApi-H2a3O-a6.js";import{S as o}from"./useNotifier-C3gm9LlJ.js";import{E as Ae,V as Ee}from"./ErrorBoundary-DJvKZGfQ.js";import{F as z}from"./FormControl-D-oBzX_C.js";import{I as A,S as E}from"./TextField-dkTUQuhn.js";import{M as N}from"./Delete-C5-Z8bWn.js";import"./Grid-Cq2i7Qbd.js";import"./TooltipWithParser-Ct71_EQj.js";import"./CodeEditor-BMRRi0Ll.js";const Ne=()=>$.get("/marketplaces/chatflows"),We=()=>$.get("/marketplaces/tools"),Ve=()=>$.get("/marketplaces/templates"),Ue={getAllChatflowsMarketplaces:Ne,getAllToolsMarketplaces:We,getAllTemplatesFromMarketplaces:Ve},r=le(ye)(({theme:d})=>({borderColor:d.palette.grey[900]+25,[`&.${_.head}`]:{color:d.palette.grey[900]},[`&.${_.body}`]:{fontSize:14,height:64}})),W=le(ae)(()=>({"&:last-child td, &:last-child th":{border:0}})),oe=({data:d,filterFunction:c,filterByBadge:g,filterByType:S,filterByFramework:f,goToCanvas:j,goToTool:y,isLoading:B})=>{const m=ie(),h=be(l=>l.customization),F=l=>{l.flowData?j(l):y(l)};return e.jsx(e.Fragment,{children:e.jsx(Ce,{sx:{border:1,borderColor:m.palette.grey[900]+25,borderRadius:2},component:we,children:e.jsxs(Te,{sx:{minWidth:650},size:"small","aria-label":"a dense table",children:[e.jsx(ke,{sx:{backgroundColor:h.isDarkMode?m.palette.common.black:m.palette.grey[100],height:56},children:e.jsxs(ae,{children:[e.jsx(r,{component:"th",scope:"row",style:{width:"15%"},children:"Name"},"0"),e.jsx(r,{component:"th",scope:"row",style:{width:"5%"},children:"Type"},"1"),e.jsx(r,{style:{width:"35%"},children:"Description"},"2"),e.jsx(r,{style:{width:"35%"},children:"Nodes"},"3"),e.jsx(r,{component:"th",scope:"row",style:{width:"5%"},children:"Â "},"4")]})}),e.jsx(ve,{children:B?e.jsxs(e.Fragment,{children:[e.jsxs(W,{children:[e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})})]}),e.jsxs(W,{children:[e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})}),e.jsx(r,{children:e.jsx(o,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:d==null?void 0:d.filter(g).filter(S).filter(c).filter(f).map((l,a)=>e.jsxs(W,{children:[e.jsx(r,{children:e.jsx(T,{sx:{display:"-webkit-box",fontSize:14,fontWeight:500,WebkitLineClamp:2,WebkitBoxOrient:"vertical",textOverflow:"ellipsis",overflow:"hidden"},children:e.jsx(Oe,{onClick:()=>F(l),sx:{textAlign:"left"},children:l.templateName||l.name})})},"0"),e.jsx(r,{children:e.jsx(T,{children:l.type})},"1"),e.jsx(r,{children:e.jsx(T,{sx:{overflowWrap:"break-word",whiteSpace:"pre-line"},children:l.description||""})},"2"),e.jsx(r,{children:e.jsx("div",{style:{display:"flex",flexDirection:"row",flexWrap:"wrap",marginTop:5},children:l.categories&&l.categories.split(",").map((p,u)=>e.jsx(ee,{variant:"outlined",size:"small",label:p.toUpperCase(),style:{marginRight:3,marginBottom:3}},u))})},"3"),e.jsx(r,{children:e.jsx(T,{children:l.badge&&l.badge.split(";").map((p,u)=>e.jsx(ee,{color:p==="POPULAR"?"primary":"error",size:"small",label:p.toUpperCase(),style:{marginRight:5,marginBottom:5}},u))})},"4")]},a))})})]})})})};oe.propTypes={data:n.array,filterFunction:n.func,filterByBadge:n.func,filterByType:n.func,filterByFramework:n.func,goToTool:n.func,goToCanvas:n.func,isLoading:n.bool};n.node,n.number.isRequired,n.number.isRequired;const $e=["POPULAR","NEW"],Ge=["Chatflow","Tool"],qe=["Langchain","LlamaIndex"],V={PaperProps:{style:{width:160}}},U={"& .MuiOutlinedInput-notchedOutline":{borderRadius:2}},it=()=>{var K,Y,Q;const d=Se(),c=ie(),[g,S]=i.useState(!0),[f,j]=i.useState(null),[y,B]=i.useState({}),[m,h]=i.useState(!1),[F,l]=i.useState({}),a=ze(Ue.getAllTemplatesFromMarketplaces),[p,u]=i.useState(localStorage.getItem("mpDisplayStyle")||"card"),[D,ne]=i.useState(""),[b,ce]=i.useState([]),[C,de]=i.useState([]),[w,pe]=i.useState([]),xe=t=>{const{target:{value:s}}=t;ce(typeof s=="string"?s.split(","):s)},he=t=>{const{target:{value:s}}=t;de(typeof s=="string"?s.split(","):s)},ge=t=>{const{target:{value:s}}=t;pe(typeof s=="string"?s.split(","):s)},me=(t,s)=>{s!==null&&(localStorage.setItem("mpDisplayStyle",s),u(s))},ue=t=>{ne(t.target.value)};function G(t){var s;return((s=t.categories)==null?void 0:s.toLowerCase().indexOf(D.toLowerCase()))>-1||t.templateName.toLowerCase().indexOf(D.toLowerCase())>-1||t.description&&t.description.toLowerCase().indexOf(D.toLowerCase())>-1}function q(t){return b.length>0?b.includes(t.badge):!0}function H(t){return C.length>0?C.includes(t.type):!0}function J(t){return w.length>0?w.includes(t.framework):!0}const fe=t=>{l({title:"Add New Tool",type:"IMPORT",cancelButtonName:"Cancel",confirmButtonName:"Add",data:t}),h(!0)},I=t=>{const s={title:t.templateName,type:"TEMPLATE",data:t};l(s),h(!0)},M=t=>{d(`/marketplace/${t.id}`,{state:t})};return i.useEffect(()=>{a.request()},[]),i.useEffect(()=>{S(a.loading)},[a.loading]),i.useEffect(()=>{if(a.data)try{const t=a.data,s={};for(let x=0;x<t.length;x+=1)if(t[x].flowData){const je=t[x].flowData,X=JSON.parse(je).nodes||[];s[t[x].id]=[];for(let P=0;P<X.length;P+=1){const Z=`${Be}/api/v1/node-icon/${X[P].data.name}`;s[t[x].id].includes(Z)||s[t[x].id].push(Z)}}B(s)}catch(t){console.error(t)}},[a.data]),i.useEffect(()=>{a.error&&j(a.error)},[a.error]),e.jsxs(e.Fragment,{children:[e.jsx(Fe,{children:f?e.jsx(Ae,{error:f}):e.jsxs(se,{flexDirection:"column",sx:{gap:3},children:[e.jsx(Ee,{filters:e.jsxs(e.Fragment,{children:[e.jsxs(z,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(A,{size:"small",id:"filter-badge-label",children:"Tag"}),e.jsx(E,{labelId:"filter-badge-label",id:"filter-badge-checkbox",size:"small",multiple:!0,value:b,onChange:xe,input:e.jsx(O,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:V,sx:U,children:$e.map(t=>e.jsxs(N,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(R,{checked:b.indexOf(t)>-1,sx:{p:0}}),e.jsx(L,{primary:t})]},t))})]}),e.jsxs(z,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(A,{size:"small",id:"type-badge-label",children:"Type"}),e.jsx(E,{size:"small",labelId:"type-badge-label",id:"type-badge-checkbox",multiple:!0,value:C,onChange:he,input:e.jsx(O,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:V,sx:U,children:Ge.map(t=>e.jsxs(N,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(R,{checked:C.indexOf(t)>-1,sx:{p:0}}),e.jsx(L,{primary:t})]},t))})]}),e.jsxs(z,{sx:{borderRadius:2,display:"flex",flexDirection:"column",justifyContent:"end",minWidth:120},children:[e.jsx(A,{size:"small",id:"type-fw-label",children:"Framework"}),e.jsx(E,{size:"small",labelId:"type-fw-label",id:"type-fw-checkbox",multiple:!0,value:w,onChange:ge,input:e.jsx(O,{label:"Badge"}),renderValue:t=>t.join(", "),MenuProps:V,sx:U,children:qe.map(t=>e.jsxs(N,{value:t,sx:{display:"flex",alignItems:"center",gap:1,p:1},children:[e.jsx(R,{checked:w.indexOf(t)>-1,sx:{p:0}}),e.jsx(L,{primary:t})]},t))})]})]}),onSearchChange:ue,search:!0,searchPlaceholder:"Search Name/Description/Node",title:"Marketplace",children:e.jsxs(Me,{sx:{borderRadius:2,height:"100%"},value:p,color:"primary",exclusive:!0,onChange:me,children:[e.jsx(re,{sx:{borderColor:c.palette.grey[900]+25,borderRadius:2,color:(K=c==null?void 0:c.customization)!=null&&K.isDarkMode?"white":"inherit"},variant:"contained",value:"card",title:"Card View",children:e.jsx(De,{})}),e.jsx(re,{sx:{borderColor:c.palette.grey[900]+25,borderRadius:2,color:(Y=c==null?void 0:c.customization)!=null&&Y.isDarkMode?"white":"inherit"},variant:"contained",value:"list",title:"List View",children:e.jsx(Ie,{})})]})}),!p||p==="card"?e.jsx(e.Fragment,{children:g?e.jsxs(k,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:[e.jsx(o,{variant:"rounded",height:160}),e.jsx(o,{variant:"rounded",height:160}),e.jsx(o,{variant:"rounded",height:160})]}):e.jsx(k,{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:te,children:(Q=a.data)==null?void 0:Q.filter(q).filter(H).filter(G).filter(J).map((t,s)=>e.jsxs(k,{children:[t.badge&&e.jsxs(Le,{sx:{width:"100%",height:"100%","& .MuiBadge-badge":{right:20}},badgeContent:t.badge,color:t.badge==="POPULAR"?"primary":"error",children:[t.type==="Chatflow"&&e.jsx(v,{onClick:()=>M(t),data:t,images:y[t.id]}),t.type==="Tool"&&e.jsx(v,{data:t,onClick:()=>I(t)})]}),!t.badge&&t.type==="Chatflow"&&e.jsx(v,{onClick:()=>M(t),data:t,images:y[t.id]}),!t.badge&&t.type==="Tool"&&e.jsx(v,{data:t,onClick:()=>I(t)})]},s))})}):e.jsx(oe,{data:a.data,filterFunction:G,filterByType:H,filterByBadge:q,filterByFramework:J,goToTool:I,goToCanvas:M,isLoading:g,setError:j}),!g&&(!a.data||a.data.length===0)&&e.jsxs(se,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(k,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:Pe,alt:"WorkflowEmptySVG"})}),e.jsx("div",{children:"No Marketplace Yet"})]})]})}),e.jsx(Re,{show:m,dialogProps:F,onCancel:()=>h(!1),onConfirm:()=>h(!1),onUseTemplate:t=>fe(t)})]})};export{it as default};
