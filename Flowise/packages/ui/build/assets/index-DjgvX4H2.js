import{P as T,o as Y,u as W,a as o,j as e,D as pe,b as je,c as ue,B as O,T as N,Y as X,d as me,q as k,k as H,l as Z,s as U,m as ge,t as G,n as b,Z as l,p as fe,M as Ce,X as we,v as Ke,w as ke,x as J,y as Q,z as ee,$ as be,a0 as ve,a1 as Ae,a2 as De,a3 as Se,a4 as Ie,a5 as Pe,C as Ee}from"./index-BgTNlE3K.js";import{S as R,P as te,O as Te,D as Ne,a as se,B as v,u as Be}from"./useApi-H2a3O-a6.js";import{a as $,m as L}from"./moment-CzKz41DL.js";import{u as ae,I as K,a as Me,S as r,C as Oe}from"./useNotifier-C3gm9LlJ.js";import{E as Re,V as $e}from"./ErrorBoundary-DJvKZGfQ.js";const ne=({show:t,dialogProps:i,onCancel:x,onConfirm:p,setError:c})=>{const m=document.getElementById("portal"),g=Y(),j=W();ae();const u=(...n)=>j(H(...n)),f=(...n)=>j(Z(...n)),[y,A]=o.useState(""),[D,S]=o.useState(null),F=!!D;o.useEffect(()=>{i.type==="EDIT"&&i.key?A(i.key.keyName):i.type==="ADD"&&A("")},[i]);const I=()=>{S(null)},B=async()=>{try{(await $.createNewAPI({keyName:y})).data&&(u({message:"New API key added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:h=>e.jsx(v,{style:{color:"white"},onClick:()=>f(h),children:e.jsx(k,{})})}}),p())}catch(n){c(n),u({message:`Failed to add new API key: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:h=>e.jsx(v,{style:{color:"white"},onClick:()=>f(h),children:e.jsx(k,{})})}}),x()}},P=async()=>{try{(await $.updateAPI(i.key.id,{keyName:y})).data&&(u({message:"API Key saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:h=>e.jsx(v,{style:{color:"white"},onClick:()=>f(h),children:e.jsx(k,{})})}}),p())}catch(n){c(n),u({message:`Failed to save API key: ${typeof n.response.data=="object"?n.response.data.message:n.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:h=>e.jsx(v,{style:{color:"white"},onClick:()=>f(h),children:e.jsx(k,{})})}}),x()}},M=t?e.jsxs(pe,{fullWidth:!0,maxWidth:"sm",open:t,onClose:x,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(je,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:i.title}),e.jsxs(ue,{children:[i.type==="EDIT"&&e.jsxs(O,{sx:{p:2},children:[e.jsx(N,{variant:"overline",children:"API Key"}),e.jsxs(R,{direction:"row",sx:{mb:1},children:[e.jsx(N,{sx:{p:1,borderRadius:10,backgroundColor:g.palette.primary.light,width:"max-content",height:"max-content"},variant:"h5",children:i.key.apiKey}),e.jsx(K,{title:"Copy API Key",color:"success",onClick:n=>{navigator.clipboard.writeText(i.key.apiKey),S(n.currentTarget),setTimeout(()=>{I()},1500)},children:e.jsx(X,{})}),e.jsx(te,{open:F,anchorEl:D,onClose:I,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(N,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:g.palette.success.dark},children:"Copied!"})})]})]}),e.jsxs(O,{sx:{p:2},children:[e.jsx(R,{sx:{position:"relative"},direction:"row",children:e.jsx(N,{variant:"overline",children:"Key Name"})}),e.jsx(Te,{id:"keyName",type:"string",fullWidth:!0,placeholder:"My New Key",value:y,name:"keyName",onChange:n=>A(n.target.value)})]})]}),e.jsx(Ne,{children:e.jsx(se,{variant:"contained",onClick:()=>i.type==="ADD"?B():P(),id:i.customBtnId,children:i.confirmButtonName})})]}):null;return me.createPortal(M,m)};ne.propTypes={show:T.bool,dialogProps:T.object,onCancel:T.func,onConfirm:T.func,setError:T.func};const Fe="/assets/api_empty-CBGH5wg8.svg",s=U(ge)(({theme:t})=>({borderColor:t.palette.grey[900]+25,padding:"6px 16px",[`&.${G.head}`]:{color:t.palette.grey[900]},[`&.${G.body}`]:{fontSize:14,height:64}})),V=U(b)(()=>({"&:last-child td, &:last-child th":{border:0}}));function ie(t){const[i,x]=o.useState(!1),p=Y();return e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{"&:last-child td, &:last-child th":{border:0}},children:[e.jsx(s,{scope:"row",style:{width:"15%"},children:t.apiKey.keyName}),e.jsxs(s,{style:{width:"40%"},children:[t.showApiKeys.includes(t.apiKey.apiKey)?t.apiKey.apiKey:`${t.apiKey.apiKey.substring(0,2)}${"•".repeat(18)}${t.apiKey.apiKey.substring(t.apiKey.apiKey.length-5)}`,e.jsx(K,{title:"Copy",color:"success",onClick:t.onCopyClick,children:e.jsx(X,{})}),e.jsx(K,{title:"Show",color:"inherit",onClick:t.onShowAPIClick,children:t.showApiKeys.includes(t.apiKey.apiKey)?e.jsx(be,{}):e.jsx(ve,{})}),e.jsx(te,{open:t.open,anchorEl:t.anchorEl,onClose:t.onClose,anchorOrigin:{vertical:"top",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"left"},children:e.jsx(N,{variant:"h6",sx:{pl:1,pr:1,color:"white",background:t.theme.palette.success.dark},children:"Copied!"})})]}),e.jsxs(s,{children:[t.apiKey.chatFlows.length," ",t.apiKey.chatFlows.length>0&&e.jsx(K,{"aria-label":"expand row",size:"small",color:"inherit",onClick:()=>x(!i),children:t.apiKey.chatFlows.length>0&&i?e.jsx(Ae,{}):e.jsx(De,{})})]}),e.jsx(s,{children:L(t.apiKey.createdAt).format("MMMM Do, YYYY")}),e.jsx(s,{children:e.jsx(K,{title:"Edit",color:"primary",onClick:t.onEditClick,children:e.jsx(Se,{})})}),e.jsx(s,{children:e.jsx(K,{title:"Delete",color:"error",onClick:t.onDeleteClick,children:e.jsx(Ie,{})})})]}),i&&e.jsx(b,{sx:{"& td":{border:0}},children:e.jsx(s,{sx:{p:2},colSpan:6,children:e.jsx(Pe,{in:i,timeout:"auto",unmountOnExit:!0,children:e.jsx(O,{sx:{borderRadius:2,border:1,borderColor:p.palette.grey[900]+25,overflow:"hidden"},children:e.jsxs(J,{"aria-label":"chatflow table",children:[e.jsx(Q,{sx:{height:48},children:e.jsxs(b,{children:[e.jsx(s,{sx:{width:"30%"},children:"Chatflow Name"}),e.jsx(s,{sx:{width:"20%"},children:"Modified On"}),e.jsx(s,{sx:{width:"50%"},children:"Category"})]})}),e.jsx(ee,{children:t.apiKey.chatFlows.map((c,m)=>e.jsxs(b,{children:[e.jsx(s,{children:c.flowName}),e.jsx(s,{children:L(c.updatedDate).format("MMMM Do, YYYY")}),e.jsxs(s,{children:[" ",c.category&&c.category.split(";").map((g,j)=>e.jsx(Ee,{label:g,style:{marginRight:5,marginBottom:5}},j))]})]},m))})]})})})})})]})}ie.propTypes={apiKey:l.any,showApiKeys:l.arrayOf(l.any),onCopyClick:l.func,onShowAPIClick:l.func,open:l.bool,anchorEl:l.any,onClose:l.func,theme:l.any,onEditClick:l.func,onDeleteClick:l.func};const Le=()=>{const t=Y(),i=fe(a=>a.customization),x=W();ae();const p=(...a)=>x(H(...a)),c=(...a)=>x(Z(...a)),[m,g]=o.useState(!0),[j,u]=o.useState(null),[f,y]=o.useState(!1),[A,D]=o.useState({}),[S,F]=o.useState([]),[I,B]=o.useState(null),[P,M]=o.useState([]),n=!!I,[h,oe]=o.useState(""),re=a=>{oe(a.target.value)};function le(a){return a.keyName.toLowerCase().indexOf(h.toLowerCase())>-1}const{confirm:ce}=Me(),d=Be($.getAllAPIKeys),de=a=>{if(P.indexOf(a)>-1){const C=P.filter(function(w){return w!==a});M(C)}else M(C=>[...C,a])},q=()=>{B(null)},he=()=>{D({title:"Add New API Key",type:"ADD",cancelButtonName:"Cancel",confirmButtonName:"Add",customBtnId:"btn_confirmAddingApiKey"}),y(!0)},xe=a=>{D({title:"Edit API Key",type:"EDIT",cancelButtonName:"Cancel",confirmButtonName:"Save",customBtnId:"btn_confirmEditingApiKey",key:a}),y(!0)},ye=async a=>{const E={title:"Delete",description:a.chatFlows.length===0?`Delete key [${a.keyName}] ? `:`Delete key [${a.keyName}] ?
 There are ${a.chatFlows.length} chatflows using this key.`,confirmButtonName:"Delete",cancelButtonName:"Cancel",customBtnId:"btn_initiateDeleteApiKey"};if(await ce(E))try{(await $.deleteAPI(a.id)).data&&(p({message:"API key deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:z=>e.jsx(v,{style:{color:"white"},onClick:()=>c(z),children:e.jsx(k,{})})}}),_())}catch(w){p({message:`Failed to delete API key: ${typeof w.response.data=="object"?w.response.data.message:w.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:z=>e.jsx(v,{style:{color:"white"},onClick:()=>c(z),children:e.jsx(k,{})})}}),onCancel()}},_=()=>{y(!1),d.request()};return o.useEffect(()=>{d.request()},[]),o.useEffect(()=>{g(d.loading)},[d.loading]),o.useEffect(()=>{d.data&&F(d.data)},[d.data]),o.useEffect(()=>{d.error&&u(d.error)},[d.error]),e.jsxs(e.Fragment,{children:[e.jsx(Ce,{children:j?e.jsx(Re,{error:j}):e.jsxs(R,{flexDirection:"column",sx:{gap:3},children:[e.jsx($e,{onSearchChange:re,search:!0,searchPlaceholder:"Search API Keys",title:"API Keys",children:e.jsx(se,{variant:"contained",sx:{borderRadius:2,height:"100%"},onClick:he,startIcon:e.jsx(we,{}),id:"btn_createApiKey",children:"Create Key"})}),!m&&S.length<=0?e.jsxs(R,{sx:{alignItems:"center",justifyContent:"center"},flexDirection:"column",children:[e.jsx(O,{sx:{p:2,height:"auto"},children:e.jsx("img",{style:{objectFit:"cover",height:"16vh",width:"auto"},src:Fe,alt:"APIEmptySVG"})}),e.jsx("div",{children:"No API Keys Yet"})]}):e.jsx(Ke,{sx:{border:1,borderColor:t.palette.grey[900]+25,borderRadius:2},component:ke,children:e.jsxs(J,{sx:{minWidth:650},"aria-label":"simple table",children:[e.jsx(Q,{sx:{backgroundColor:i.isDarkMode?t.palette.common.black:t.palette.grey[100],height:56},children:e.jsxs(b,{children:[e.jsx(s,{children:"Key Name"}),e.jsx(s,{children:"API Key"}),e.jsx(s,{children:"Usage"}),e.jsx(s,{children:"Created"}),e.jsx(s,{children:" "}),e.jsx(s,{children:" "})]})}),e.jsx(ee,{children:m?e.jsxs(e.Fragment,{children:[e.jsxs(V,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]}),e.jsxs(V,{children:[e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})}),e.jsx(s,{children:e.jsx(r,{variant:"text"})})]})]}):e.jsx(e.Fragment,{children:S.filter(le).map((a,E)=>e.jsx(ie,{apiKey:a,showApiKeys:P,onCopyClick:C=>{navigator.clipboard.writeText(a.apiKey),B(C.currentTarget),setTimeout(()=>{q()},1500)},onShowAPIClick:()=>de(a.apiKey),open:n,anchorEl:I,onClose:q,theme:t,onEditClick:()=>xe(a),onDeleteClick:()=>ye(a)},E))})})]})})]})}),e.jsx(ne,{show:f,dialogProps:A,onCancel:()=>y(!1),onConfirm:_,setError:u}),e.jsx(Oe,{})]})};export{Le as default};
