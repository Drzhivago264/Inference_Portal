import{s as Se,aC as Ie,P as r,p as Ce,a as o,j as e,B as w,T as S,o as ke,bp as Te,bV as Oe,bW as Ne,D as re,b as le,c as ce,d as de,u as Fe,S as Re,H as ae,q as k,k as $e,l as Be}from"./index-BgTNlE3K.js";import{B as I,a as L,b as N,u as ie,S as O,O as Q,D as Me}from"./useApi-H2a3O-a6.js";import{a as V}from"./TooltipWithParser-Ct71_EQj.js";import{D as Ee}from"./Dropdown-CBMARjVX.js";import{b as Ue,A as We,T as Je}from"./TextField-dkTUQuhn.js";import{F as pe}from"./FormControl-D-oBzX_C.js";import{C as ze}from"./CredentialInputHandler-Tm9MuCGQ.js";import{C as qe}from"./Grid-Cq2i7Qbd.js";import{u as Ve,I as _e}from"./useNotifier-C3gm9LlJ.js";let Y;const Le=new Uint8Array(16);function He(){if(!Y&&(Y=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!Y))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return Y(Le)}const h=[];for(let n=0;n<256;++n)h.push((n+256).toString(16).slice(1));function Ge(n,s=0){return h[n[s+0]]+h[n[s+1]]+h[n[s+2]]+h[n[s+3]]+"-"+h[n[s+4]]+h[n[s+5]]+"-"+h[n[s+6]]+h[n[s+7]]+"-"+h[n[s+8]]+h[n[s+9]]+"-"+h[n[s+10]]+h[n[s+11]]+h[n[s+12]]+h[n[s+13]]+h[n[s+14]]+h[n[s+15]]}const Xe=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),oe={randomUUID:Xe};function _(n,s,u){if(oe.randomUUID&&!s&&!n)return oe.randomUUID();n=n||{};const x=n.random||(n.rng||He)();if(x[6]=x[6]&15|64,x[8]=x[8]&63|128,s){u=u||0;for(let g=0;g<16;++g)s[u+g]=x[g];return s}return Ge(x)}const Ke=Se(Ie)({boxShadow:"0px 8px 10px -5px rgb(0 0 0 / 20%), 0px 16px 24px 2px rgb(0 0 0 / 14%), 0px 6px 30px 5px rgb(0 0 0 / 12%)",borderRadius:"10px",[`& .${Ue.listbox}`]:{boxSizing:"border-box","& ul":{padding:10,margin:10}}}),ue=({name:n,value:s,options:u,onSelect:x,formControlSx:g={},disabled:T=!1,disableClearable:y=!1})=>{const j=Ce(i=>i.customization),c=(i=[],l)=>{let d=[];return l&&typeof l=="string"?d=JSON.parse(l):d=l,i.filter(p=>d.includes(p.name))},m=()=>[];let[f,D]=o.useState(s??[]);return e.jsx(pe,{sx:{mt:1,width:"100%",...g},size:"small",children:e.jsx(We,{id:n,disabled:T,disableClearable:y,size:"small",multiple:!0,filterSelectedOptions:!0,options:u||[],value:c(u,f)||m(),onChange:(i,l)=>{let d="";if(l.length){const p=[];for(let b=0;b<l.length;b+=1)p.push(l[b].name);d=JSON.stringify(p)}D(d),x(d)},PopperComponent:Ke,renderInput:i=>e.jsx(Je,{...i,value:f,sx:{height:"100%","& .MuiInputBase-root":{height:"100%"}}}),renderOption:(i,l)=>e.jsx(w,{component:"li",...i,children:e.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[e.jsx(S,{variant:"h5",children:l.label}),l.description&&e.jsx(S,{sx:{color:j.isDarkMode?"#9e9e9e":""},children:l.description})]})}),sx:{height:"100%"}})})};ue.propTypes={name:r.string,value:r.string,options:r.array,onSelect:r.func,disabled:r.bool,formControlSx:r.object,disableClearable:r.bool};const me=({value:n,fileType:s,onChange:u,disabled:x=!1})=>{const g=ke(),[T,y]=o.useState(n??""),j=async c=>{if(c.target.files){if(c.target.files.length===1){const m=c.target.files[0],{name:f}=m,D=new FileReader;D.onload=i=>{var p;if(!((p=i==null?void 0:i.target)!=null&&p.result))return;const{result:l}=i.target,d=l+`,filename:${f}`;y(d),u(d)},D.readAsDataURL(m)}else if(c.target.files.length>0){let m=Array.from(c.target.files).map(D=>{const i=new FileReader,{name:l}=D;return new Promise(d=>{i.onload=p=>{var C;if(!((C=p==null?void 0:p.target)!=null&&C.result))return;const{result:b}=p.target,z=b+`,filename:${l}`;d(z)},i.readAsDataURL(D)})});const f=await Promise.all(m);y(JSON.stringify(f)),u(JSON.stringify(f))}}};return e.jsxs(pe,{sx:{mt:1,width:"100%"},size:"small",children:[e.jsx("span",{style:{fontStyle:"italic",color:g.palette.grey[800],marginBottom:"1rem"},children:T?Te(T):"Choose a file to upload"}),e.jsxs(I,{disabled:x,variant:"outlined",component:"label",fullWidth:!0,startIcon:e.jsx(Oe,{}),sx:{marginRight:"1rem"},children:["Upload File",e.jsx("input",{type:"file",multiple:!0,accept:s,hidden:!0,onChange:c=>j(c)})]})]})};me.propTypes={value:r.string,fileType:r.string,onChange:r.func,disabled:r.bool};const he=({open:n})=>e.jsx("div",{children:e.jsx(Ne,{sx:{color:"#fff",zIndex:s=>s.zIndex.drawer+1},open:n,children:e.jsx(qe,{color:"inherit"})})});he.propTypes={open:r.bool};const xe=({show:n,dialogProps:s,onCancel:u,onDelete:x,onDeleteBoth:g})=>{const T=document.getElementById("portal"),y=n?e.jsxs(re,{fullWidth:!0,maxWidth:"xs",open:n,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(le,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:s.title}),e.jsxs(ce,{children:[e.jsx("span",{children:s.description}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",marginTop:20},children:[e.jsx(L,{sx:{mb:1},color:"orange",variant:"contained",onClick:x,children:"Delete only from Flowise"}),e.jsx(L,{sx:{mb:1},color:"error",variant:"contained",onClick:g,children:"Delete from both OpenAI and Flowise"}),e.jsx(I,{onClick:u,children:s.cancelButtonName})]})]})]}):null;return de.createPortal(y,T)};xe.propTypes={show:r.bool,dialogProps:r.object,onDeleteBoth:r.func,onDelete:r.func,onCancel:r.func};const Qe=()=>N.get("/assistants"),Ye=n=>N.get(`/assistants/${n}`),Ze=(n,s)=>N.get(`/openai-assistants/${n}?credential=${s}`),Pe=n=>N.get(`/openai-assistants?credential=${n}`),et=n=>N.post("/assistants",n),tt=(n,s)=>N.put(`/assistants/${n}`,s),st=(n,s)=>s?N.delete(`/assistants/${n}?isDeleteBoth=true`):N.delete(`/assistants/${n}`),J={getAllAssistants:Qe,getSpecificAssistant:Ye,getAssistantObj:Ze,getAllAvailableAssistants:Pe,createNewAssistant:et,updateAssistant:tt,deleteAssistant:st},nt=[{label:"gpt-4-turbo-preview",name:"gpt-4-turbo-preview"},{label:"gpt-4-1106-preview",name:"gpt-4-1106-preview"},{label:"gpt-4-0613",name:"gpt-4-0613"},{label:"gpt-4",name:"gpt-4"},{label:"gpt-3.5-turbo",name:"gpt-3.5-turbo"},{label:"gpt-3.5-turbo-1106",name:"gpt-3.5-turbo-1106"},{label:"gpt-3.5-turbo-0613",name:"gpt-3.5-turbo-0613"},{label:"gpt-3.5-turbo-16k",name:"gpt-3.5-turbo-16k"},{label:"gpt-3.5-turbo-16k-0613",name:"gpt-3.5-turbo-16k-0613"}],at=({show:n,dialogProps:s,onCancel:u,onConfirm:x,setError:g})=>{const T=document.getElementById("portal");Ve();const y=Fe(),j=(...t)=>y($e(...t)),c=(...t)=>y(Be(...t)),m=ie(J.getSpecificAssistant),f=ie(J.getAssistantObj),[D,i]=o.useState(""),[l,d]=o.useState(""),[p,b]=o.useState(""),[z,C]=o.useState(""),[H,$]=o.useState(`https://api.dicebear.com/7.x/bottts/svg?seed=${_()}`),[B,M]=o.useState(""),[F,E]=o.useState(""),[Z,U]=o.useState(""),[q,R]=o.useState(["code_interpreter","retrieval"]),[G,W]=o.useState([]),[X,P]=o.useState(""),[se,v]=o.useState(!1),[ge,ee]=o.useState(!1),[fe,ye]=o.useState({});o.useEffect(()=>(y(n?{type:Re}:{type:ae}),()=>y({type:ae})),[n,y]),o.useEffect(()=>{if(m.data){i(m.data.id),$(m.data.iconSrc),E(m.data.credential);const t=JSON.parse(m.data.details);d(t.id),b(t.name),C(t.description),M(t.model),U(t.instructions),R(t.tools??[]),W(t.files??[])}},[m.data]),o.useEffect(()=>{f.data&&K(f.data)},[f.data]),o.useEffect(()=>{f.error&&K(f.error)},[f.error]),o.useEffect(()=>{m.error&&K(m.error)},[m.error]),o.useEffect(()=>{if(s.type==="EDIT"&&s.data){i(s.data.id),$(s.data.iconSrc),E(s.data.credential);const t=JSON.parse(s.data.details);d(t.id),b(t.name),C(t.description),M(t.model),U(t.instructions),R(t.tools??[]),W(t.files??[])}else s.type==="EDIT"&&s.assistantId?m.request(s.assistantId):s.type==="ADD"&&s.selectedOpenAIAssistantId&&s.credential?(i(""),$(`https://api.dicebear.com/7.x/bottts/svg?seed=${_()}`),E(s.credential),f.request(s.selectedOpenAIAssistantId,s.credential)):s.type==="ADD"&&!s.selectedOpenAIAssistantId&&(i(""),$(`https://api.dicebear.com/7.x/bottts/svg?seed=${_()}`),E(""),d(""),b(""),C(""),M(""),U(""),R(["code_interpreter","retrieval"]),P(""),W([]));return()=>{i(""),$(`https://api.dicebear.com/7.x/bottts/svg?seed=${_()}`),E(""),d(""),b(""),C(""),M(""),U(""),R(["code_interpreter","retrieval"]),P(""),W([]),v(!1)}},[s]);const K=t=>{d(t.id),b(t.name),C(t.description),M(t.model),U(t.instructions),W(t.files??[]);let a=[];if(t.tools&&t.tools.length)for(const A of t.tools)a.push(A.type);R(a)},je=async()=>{v(!0);try{const a={details:JSON.stringify({id:l,name:p,description:z,model:B,instructions:Z,tools:q,files:G,uploadFiles:X}),iconSrc:H,credential:F},A=await J.createNewAssistant(a);A.data&&(j({message:"New Assistant added",options:{key:new Date().getTime()+Math.random(),variant:"success",action:te=>e.jsx(I,{style:{color:"white"},onClick:()=>c(te),children:e.jsx(k,{})})}}),x(A.data.id)),v(!1)}catch(t){g(t),j({message:`Failed to add new Assistant: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(I,{style:{color:"white"},onClick:()=>c(a),children:e.jsx(k,{})})}}),v(!1),u()}},be=async()=>{v(!0);try{const a={details:JSON.stringify({name:p,description:z,model:B,instructions:Z,tools:q,files:G,uploadFiles:X}),iconSrc:H,credential:F},A=await J.updateAssistant(D,a);A.data&&(j({message:"Assistant saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:te=>e.jsx(I,{style:{color:"white"},onClick:()=>c(te),children:e.jsx(k,{})})}}),x(A.data.id)),v(!1)}catch(t){g(t),j({message:`Failed to save Assistant: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(I,{style:{color:"white"},onClick:()=>c(a),children:e.jsx(k,{})})}}),v(!1),u()}},Ae=async()=>{v(!0);try{const t=await J.getAssistantObj(l,F);t.data&&(K(t.data),j({message:"Assistant successfully synced!",options:{key:new Date().getTime()+Math.random(),variant:"success",action:a=>e.jsx(I,{style:{color:"white"},onClick:()=>c(a),children:e.jsx(k,{})})}})),v(!1)}catch(t){g(t),j({message:`Failed to sync Assistant: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:a=>e.jsx(I,{style:{color:"white"},onClick:()=>c(a),children:e.jsx(k,{})})}}),v(!1)}},De=()=>{ye({title:"Delete Assistant",description:`Delete Assistant ${p}?`,cancelButtonName:"Cancel"}),ee(!0)},ne=async t=>{ee(!1);try{(await J.deleteAssistant(D,t)).data&&(j({message:"Assistant deleted",options:{key:new Date().getTime()+Math.random(),variant:"success",action:A=>e.jsx(I,{style:{color:"white"},onClick:()=>c(A),children:e.jsx(k,{})})}}),x())}catch(a){g(a),j({message:`Failed to delete Assistant: ${typeof a.response.data=="object"?a.response.data.message:a.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:A=>e.jsx(I,{style:{color:"white"},onClick:()=>c(A),children:e.jsx(k,{})})}}),u()}},ve=async t=>{W(G.filter(a=>a.id!==t))},we=n?e.jsxs(re,{fullWidth:!0,maxWidth:"md",open:n,onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(le,{sx:{fontSize:"1rem",p:3,pb:0},id:"alert-dialog-title",children:s.title}),e.jsx(ce,{sx:{display:"flex",flexDirection:"column",gap:2,maxHeight:"75vh",position:"relative",px:3,pb:3},children:e.jsxs(w,{sx:{display:"flex",flexDirection:"column",gap:2,pt:2},children:[e.jsxs(w,{children:[e.jsxs(O,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(S,{variant:"overline",children:"Assistant Name"}),e.jsx(V,{title:"The name of the assistant. The maximum length is 256 characters."})]}),e.jsx(Q,{id:"assistantName",type:"string",fullWidth:!0,placeholder:"My New Assistant",value:p,name:"assistantName",onChange:t=>b(t.target.value)})]}),e.jsxs(w,{children:[e.jsxs(O,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(S,{variant:"overline",children:"Assistant Description"}),e.jsx(V,{title:"The description of the assistant. The maximum length is 512 characters."})]}),e.jsx(Q,{id:"assistantDesc",type:"string",fullWidth:!0,placeholder:"Description of what the Assistant does",multiline:!0,rows:3,value:z,name:"assistantDesc",onChange:t=>C(t.target.value)})]}),e.jsxs(w,{children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsx(S,{variant:"overline",children:"Assistant Icon Src"})}),e.jsx("div",{style:{width:100,height:100,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:5,borderRadius:"50%",objectFit:"contain"},alt:p,src:H})}),e.jsx(Q,{id:"assistantIcon",type:"string",fullWidth:!0,placeholder:`https://api.dicebear.com/7.x/bottts/svg?seed=${_()}`,value:H,name:"assistantIcon",onChange:t=>$(t.target.value)})]}),e.jsxs(w,{children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["Assistant Model",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(Ee,{name:B,options:nt,onSelect:t=>M(t),value:B??"choose an option"},B)]}),e.jsxs(w,{children:[e.jsx(O,{sx:{position:"relative"},direction:"row",children:e.jsxs(S,{variant:"overline",children:["OpenAI Credential",e.jsx("span",{style:{color:"red"},children:" *"})]})}),e.jsx(ze,{data:F?{credential:F}:{},inputParam:{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["openAIApi"]},onSelect:t=>E(t)},F)]}),e.jsxs(w,{children:[e.jsxs(O,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(S,{variant:"overline",children:"Assistant Instruction"}),e.jsx(V,{title:"The system instructions that the assistant uses. The maximum length is 32768 characters."})]}),e.jsx(Q,{id:"assistantInstructions",type:"string",fullWidth:!0,placeholder:"You are a personal math tutor. When asked a question, write and run Python code to answer the question.",multiline:!0,rows:3,value:Z,name:"assistantInstructions",onChange:t=>U(t.target.value)})]}),e.jsxs(w,{children:[e.jsxs(O,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(S,{variant:"overline",children:"Assistant Tools"}),e.jsx(V,{title:"A list of tool enabled on the assistant. There can be a maximum of 128 tools per assistant."})]}),e.jsx(ue,{name:JSON.stringify(q),options:[{label:"Code Interpreter",name:"code_interpreter"},{label:"Retrieval",name:"retrieval"}],onSelect:t=>R(t?JSON.parse(t):[]),value:q??"choose an option"},JSON.stringify(q))]}),e.jsxs(w,{children:[e.jsxs(O,{sx:{position:"relative",alignItems:"center"},direction:"row",children:[e.jsx(S,{variant:"overline",children:"Knowledge Files"}),e.jsx(V,{title:"Allow assistant to use the content from uploaded files for retrieval and code interpreter. MAX: 20 files"})]}),e.jsx("div",{style:{display:"flex",flexDirection:"row"},children:G.map((t,a)=>e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",width:"max-content",height:"max-content",borderRadius:15,background:"rgb(254,252,191)",paddingLeft:15,paddingRight:15,paddingTop:5,paddingBottom:5,marginRight:10},children:[e.jsx("span",{style:{color:"rgb(116,66,16)",marginRight:10},children:t.filename}),e.jsx(_e,{sx:{height:15,width:15,p:0},onClick:()=>ve(t.id),children:e.jsx(k,{})})]},a))}),e.jsx(me,{fileType:"*",onChange:t=>P(t),value:X??"Choose a file to upload"},X)]})]})}),e.jsxs(Me,{sx:{p:3,pt:0},children:[s.type==="EDIT"&&e.jsx(L,{color:"secondary",variant:"contained",onClick:()=>Ae(),children:"Sync"}),s.type==="EDIT"&&e.jsx(L,{color:"error",variant:"contained",onClick:()=>De(),children:"Delete"}),e.jsx(L,{disabled:!(B&&F),variant:"contained",onClick:()=>s.type==="ADD"?je():be(),children:s.confirmButtonName})]}),e.jsx(xe,{show:ge,dialogProps:fe,onCancel:()=>ee(!1),onDelete:()=>ne(),onDeleteBoth:()=>ne(!0)}),se&&e.jsx(he,{open:se})]}):null;return de.createPortal(we,T)};at.propTypes={show:r.bool,dialogProps:r.object,onCancel:r.func,onConfirm:r.func};export{at as A,he as B,me as F,ue as M,J as a};
