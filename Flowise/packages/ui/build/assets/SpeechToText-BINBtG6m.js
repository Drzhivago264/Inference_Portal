import{P as y,a as p,j as e,D as q,b as V,c as H,d as X,u as O,aQ as G,B as b,aG as B,a4 as $,X as z,q as k,aP as A,k as D,l as E,T,K}from"./index-BgTNlE3K.js";import{O as I,D as _,B as j,a as S}from"./useApi-H2a3O-a6.js";import{u as M,I as F}from"./useNotifier-C3gm9LlJ.js";import{c as L}from"./chatflows-CuZYxTR0.js";import{I as R,a as W}from"./TooltipWithParser-Ct71_EQj.js";import{S as J}from"./CredentialListDialog-CbgBEUU8.js";import{C as Q}from"./CredentialInputHandler-Tm9MuCGQ.js";import{L as U,a as Y,I as Z}from"./Input-DweKhHD3.js";import{D as P}from"./Dropdown-CBMARjVX.js";import{F as ee}from"./FormControl-D-oBzX_C.js";import{S as te}from"./TextField-dkTUQuhn.js";import{M as N}from"./Delete-C5-Z8bWn.js";const se=({show:i,dialogProps:d,onCancel:u,onConfirm:f})=>{const a=document.getElementById("portal"),[l,n]=p.useState(""),[m,g]=p.useState(!1);p.useEffect(()=>{g(!!l)},[l]);const x=i?e.jsxs(q,{open:i,fullWidth:!0,maxWidth:"xs",onClose:u,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description",children:[e.jsx(V,{sx:{fontSize:"1rem"},id:"alert-dialog-title",children:d.title}),e.jsx(H,{children:e.jsx(I,{sx:{mt:1},id:"chatflow-name",type:"text",fullWidth:!0,placeholder:"My New Chatflow",value:l,onChange:c=>n(c.target.value)})}),e.jsxs(_,{children:[e.jsx(j,{onClick:u,children:d.cancelButtonName}),e.jsx(S,{disabled:!m,variant:"contained",onClick:()=>f(l),children:d.confirmButtonName})]})]}):null;return X.createPortal(x,a)};se.propTypes={show:y.bool,dialogProps:y.object,onCancel:y.func,onConfirm:y.func};const ae=({dialogProps:i})=>{const d=O();M();const u=(...t)=>d(D(...t)),f=(...t)=>d(E(...t)),[a,l]=p.useState([{prompt:""}]),[n,m]=p.useState({}),g=()=>{l([...a,{prompt:""}])},x=t=>{const o=[...a];o.splice(t,1),l(o)},c=(t,o)=>{const{name:s,value:r}=o.target,h=[...a];h[t][s]=r,l(h)},w=async()=>{try{let t={starterPrompts:{...a}};n.starterPrompts=t.starterPrompts;const o=await L.updateChatflow(i.chatflow.id,{chatbotConfig:JSON.stringify(n)});o.data&&(u({message:"Conversation Starter Prompts Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>e.jsx(j,{style:{color:"white"},onClick:()=>f(s),children:e.jsx(k,{})})}}),d({type:A,chatflow:o.data}))}catch(t){u({message:`Failed to save Conversation Starter Prompts: ${typeof t.response.data=="object"?t.response.data.message:t.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:o=>e.jsx(j,{style:{color:"white"},onClick:()=>f(o),children:e.jsx(k,{})})}})}};return p.useEffect(()=>{if(i.chatflow&&i.chatflow.chatbotConfig)try{let t=JSON.parse(i.chatflow.chatbotConfig);if(m(t||{}),t.starterPrompts){let o=[];Object.getOwnPropertyNames(t.starterPrompts).forEach(s=>{t.starterPrompts[s]&&o.push(t.starterPrompts[s])}),l(o)}else l([{prompt:""}])}catch{l([{prompt:""}])}return()=>{}},[i]),e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{display:"flex",flexDirection:"column",borderRadius:10,background:"#d8f3dc",padding:10},children:e.jsxs("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"},children:[e.jsx(G,{size:30,color:"#2d6a4f"}),e.jsx("span",{style:{color:"#2d6a4f",marginLeft:10,fontWeight:500},children:"Starter prompts will only be shown when there is no messages on the chat"})]})}),e.jsx(b,{sx:{"& > :not(style)":{m:1},pt:2},children:e.jsx(B,{children:a.map((t,o)=>e.jsxs("div",{style:{display:"flex",width:"100%"},children:[e.jsx(b,{sx:{width:"95%",mb:1},children:e.jsx(I,{sx:{width:"100%"},type:"text",onChange:s=>c(o,s),size:"small",value:t.prompt,name:"prompt",endAdornment:e.jsx(R,{position:"end",sx:{padding:"2px"},children:a.length>1&&e.jsx(F,{sx:{height:30,width:30},size:"small",color:"error",disabled:a.length===1,onClick:()=>x(o),edge:"end",children:e.jsx($,{})})})},o)}),e.jsx(b,{sx:{width:"5%",mb:1},children:o===a.length-1&&e.jsx(F,{color:"primary",onClick:g,children:e.jsx(z,{})})})]},o))})}),e.jsx(S,{variant:"contained",onClick:w,children:"Save"})]})};ae.propTypes={show:y.bool,dialogProps:y.object,onCancel:y.func,onConfirm:y.func};const oe=({dialogProps:i})=>{const d=O();M();const u=(...c)=>d(D(...c)),f=(...c)=>d(E(...c)),[a,l]=p.useState(!1),[n,m]=p.useState({}),g=c=>{l(c)},x=async()=>{try{let c={chatFeedback:{status:a}};n.chatFeedback=c.chatFeedback;const w=await L.updateChatflow(i.chatflow.id,{chatbotConfig:JSON.stringify(n)});w.data&&(u({message:"Chat Feedback Settings Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:t=>e.jsx(j,{style:{color:"white"},onClick:()=>f(t),children:e.jsx(k,{})})}}),d({type:A,chatflow:w.data}))}catch(c){u({message:`Failed to save Chat Feedback Settings: ${typeof c.response.data=="object"?c.response.data.message:c.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:w=>e.jsx(j,{style:{color:"white"},onClick:()=>f(w),children:e.jsx(k,{})})}})}};return p.useEffect(()=>{if(i.chatflow&&i.chatflow.chatbotConfig){let c=JSON.parse(i.chatflow.chatbotConfig);m(c||{}),c.chatFeedback&&l(c.chatFeedback.status)}return()=>{}},[i]),e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",mb:2},children:e.jsx(J,{label:"Enable chat feedback",onChange:g,value:a})}),e.jsx(S,{style:{marginBottom:10,marginTop:10},variant:"contained",onClick:x,children:"Save"})]})};oe.propTypes={dialogProps:y.object};const ne=({dialogProps:i})=>{const d=O();M();const u=(...s)=>d(D(...s)),f=(...s)=>d(E(...s)),[a,l]=p.useState([""]),[n,m]=p.useState(""),[g,x]=p.useState({}),c=()=>{l([...a,""])},w=s=>{const r=[...a];r.splice(s,1),l(r)},t=(s,r)=>{const{value:h}=r.target,v=[...a];v[s]=h,l(v)},o=async()=>{try{let s={allowedOrigins:[...a],allowedOriginsError:n};g.allowedOrigins=s.allowedOrigins,g.allowedOriginsError=s.allowedOriginsError;const r=await L.updateChatflow(i.chatflow.id,{chatbotConfig:JSON.stringify(g)});r.data&&(u({message:"Allowed Origins Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:h=>e.jsx(j,{style:{color:"white"},onClick:()=>f(h),children:e.jsx(k,{})})}}),d({type:A,chatflow:r.data}))}catch(s){u({message:`Failed to save Allowed Origins: ${typeof s.response.data=="object"?s.response.data.message:s.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:r=>e.jsx(j,{style:{color:"white"},onClick:()=>f(r),children:e.jsx(k,{})})}})}};return p.useEffect(()=>{if(i.chatflow&&i.chatflow.chatbotConfig)try{let s=JSON.parse(i.chatflow.chatbotConfig);if(x(s||{}),s.allowedOrigins){let r=[...s.allowedOrigins];l(r)}else l([""]);s.allowedOriginsError?m(s.allowedOriginsError):m("")}catch{l([""]),m("")}return()=>{}},[i]),e.jsxs(e.Fragment,{children:[e.jsxs(b,{children:[e.jsx(b,{sx:{display:"flex",flexDirection:"column"},children:e.jsxs(T,{sx:{mb:1},children:["Allowed Domains",e.jsx(W,{style:{mb:1,mt:2,marginLeft:10},title:"Your chatbot will only work when used from the following domains."})]})}),e.jsx(B,{children:a.map((s,r)=>e.jsxs("div",{style:{display:"flex",width:"100%"},children:[e.jsx(b,{sx:{width:"100%",mb:1},children:e.jsx(I,{sx:{width:"100%"},type:"text",onChange:h=>t(r,h),size:"small",value:s,name:"origin",placeholder:"https://example.com",endAdornment:e.jsx(R,{position:"end",sx:{padding:"2px"},children:a.length>1&&e.jsx(F,{sx:{height:30,width:30},size:"small",color:"error",disabled:a.length===1,onClick:()=>w(r),edge:"end",children:e.jsx($,{})})})},r)}),e.jsx(b,{sx:{width:"5%",mb:1},children:r===a.length-1&&e.jsx(F,{color:"primary",onClick:c,children:e.jsx(z,{})})})]},r))})]}),e.jsx(b,{sx:{pt:2,pb:2},children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-start"},children:[e.jsxs(T,{sx:{mb:1},children:["Error Message",e.jsx(W,{style:{mb:1,mt:2,marginLeft:10},title:"Custom error message that will be shown when for unauthorized domain"})]}),e.jsx(I,{sx:{width:"100%"},type:"text",size:"small",fullWidth:!0,placeholder:"Unauthorized domain!",value:n,onChange:s=>{m(s.target.value)}})]})}),e.jsx(S,{variant:"contained",onClick:o,children:"Save"})]})};ne.propTypes={dialogProps:y.object};const re="data:image/svg+xml,%3csvg%20width='32'%20height='32'%20viewBox='0%200%2032%2032'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.9814%2025.2665C15.353%2026.2672%2016.0645%2027.1054%2016.9914%2027.6347C17.9183%2028.164%2019.0018%2028.3507%2020.0524%2028.1622C21.103%2027.9737%2022.054%2027.422%2022.7391%2026.6034C23.4242%2025.7849%2023.7998%2024.7517%2023.8004%2023.6842V17.5533C23.8004%2017.1909%2023.6043%2016.8569%2023.2879%2016.6802L15.9995%2012.6108'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M7.17701%2019.5848C6.49568%2020.4069%206.12505%2021.4424%206.12993%2022.5101C6.13481%2023.5779%206.51489%2024.6099%207.2037%2025.4258C7.89252%2026.2416%208.84622%2026.7893%209.89802%2026.9732C10.9498%2027.157%2012.0328%2026.9653%2012.9575%2026.4314L18.1044%2023.4263C18.4114%2023.247%2018.6002%2022.9182%2018.6002%2022.5627V14.106'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M8.19877%209.98459C6.39026%209.67775%204.57524%2010.4982%203.60403%2012.1806C3.00524%2013.2178%202.84295%2014.4504%203.15284%2015.6073C3.46273%2016.7642%204.21943%2017.7507%205.25652%2018.3498L10.3049%2021.3269C10.6109%2021.5074%2010.9898%2021.5119%2011.3001%2021.3388L18.6%2017.2655'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M17.0172%206.06585C16.6456%205.06522%2015.9342%204.227%2015.0072%203.6977C14.0803%203.1684%2012.9969%202.98168%2011.9462%203.17018C10.8956%203.35869%209.94464%203.91042%209.25954%204.72895C8.57444%205.54747%208.19879%206.58074%208.19824%207.64814V13.6575C8.19824%2014.0154%208.38951%2014.346%208.69977%2014.5244L15.9992%2018.7215'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M24.8216%2011.7476C25.5029%2010.9255%2025.8735%209.89004%2025.8687%208.8223C25.8638%207.75457%2025.4837%206.72253%2024.7949%205.90667C24.1061%205.09082%2023.1524%204.54308%2022.1006%204.35924C21.0488%204.17541%2019.9658%204.36718%2019.0411%204.90101L13.8942%207.90613C13.5872%208.08539%2013.3984%208.41418%2013.3984%208.76971V17.2265'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3cpath%20d='M23.7997%2021.2595C25.6082%2021.5663%2027.4232%2020.7459%2028.3944%2019.0635C28.9932%2018.0263%2029.1555%2016.7937%2028.8456%2015.6368C28.5357%2014.4799%2027.779%2013.4934%2026.7419%2012.8943L21.6409%209.91752C21.3316%209.73703%2020.9494%209.7357%2020.6388%209.91405L17.2696%2011.849L13.3984%2014.0723'%20stroke='black'%20stroke-width='2'%20stroke-linecap='round'%20stroke-linejoin='round'/%3e%3c/svg%3e",ie="/assets/assemblyai-DgONwkn3.png",C={openAIWhisper:{label:"OpenAI Whisper",name:"openAIWhisper",icon:re,url:"https://platform.openai.com/docs/guides/speech-to-text",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["openAIApi"]},{label:"Language",name:"language",type:"string",description:"The language of the input audio. Supplying the input language in ISO-639-1 format will improve accuracy and latency.",placeholder:"en",optional:!0},{label:"Prompt",name:"prompt",type:"string",rows:4,description:"An optional text to guide the model's style or continue a previous audio segment. The prompt should match the audio language.",optional:!0},{label:"Temperature",name:"temperature",type:"number",step:.1,description:"The sampling temperature, between 0 and 1. Higher values like 0.8 will make the output more random, while lower values like 0.2 will make it more focused and deterministic.",optional:!0}]},assemblyAiTranscribe:{label:"Assembly AI",name:"assemblyAiTranscribe",icon:ie,url:"https://www.assemblyai.com/",inputs:[{label:"Connect Credential",name:"credential",type:"credential",credentialNames:["assemblyAIApi"]}]}},le=({dialogProps:i})=>{var w;const d=O();M();const u=(...t)=>d(D(...t)),f=(...t)=>d(E(...t)),[a,l]=p.useState({}),[n,m]=p.useState("none"),g=async()=>{const t=x(!0,n,"status");try{const o=await L.updateChatflow(i.chatflow.id,{speechToText:JSON.stringify(t)});o.data&&(u({message:"Speech To Text Configuration Saved",options:{key:new Date().getTime()+Math.random(),variant:"success",action:s=>e.jsx(j,{style:{color:"white"},onClick:()=>f(s),children:e.jsx(k,{})})}}),d({type:A,chatflow:o.data}))}catch(o){u({message:`Failed to save Speech To Text Configuration: ${typeof o.response.data=="object"?o.response.data.message:o.response.data}`,options:{key:new Date().getTime()+Math.random(),variant:"error",persist:!0,action:s=>e.jsx(j,{style:{color:"white"},onClick:()=>f(s),children:e.jsx(k,{})})}})}},x=(t,o,s)=>{let r={};return Object.prototype.hasOwnProperty.call(a,o)?r={...a}:r={...a,[o]:{}},r[o][s]=t,s==="status"&&t===!0&&Object.keys(C).forEach(h=>{const v=C[h];v.name!==o&&(r[v.name]={...a[v.name],status:!1})}),l(r),r},c=t=>{m(t.target.value)};return p.useEffect(()=>{if(i.chatflow&&i.chatflow.speechToText)try{const t=JSON.parse(i.chatflow.speechToText);let o="none";Object.keys(C).forEach(s=>{const r=t[s];r&&r.status&&(o=s)}),m(o),l(t)}catch(t){l({}),m("none"),console.error(t)}return()=>{l({}),m("none")}},[i]),e.jsxs(e.Fragment,{children:[e.jsxs(b,{fullWidth:!0,sx:{mb:1,display:"flex",flexDirection:"column",gap:1},children:[e.jsx(T,{variant:"h4",sx:{mb:1},children:"Providers"}),e.jsx(ee,{fullWidth:!0,children:e.jsxs(te,{size:"small",value:n,onChange:c,children:[e.jsx(N,{value:"none",children:"None"}),e.jsx(N,{value:"openAIWhisper",children:"OpenAI Whisper"}),e.jsx(N,{value:"assemblyAiTranscribe",children:"Assembly AI"})]})})]}),n!=="none"&&e.jsxs(e.Fragment,{children:[e.jsxs(U,{sx:{mt:3},alignItems:"center",children:[e.jsx(Y,{children:e.jsx("div",{style:{width:50,height:50,borderRadius:"50%",backgroundColor:"white"},children:e.jsx("img",{style:{width:"100%",height:"100%",padding:10,objectFit:"contain"},alt:"AI",src:C[n].icon})})}),e.jsx(K,{sx:{ml:1},primary:C[n].label,secondary:e.jsx("a",{target:"_blank",rel:"noreferrer",href:C[n].url,children:C[n].url})})]}),C[n].inputs.map((t,o)=>{var s,r;return e.jsxs(b,{sx:{p:2},children:[e.jsx("div",{style:{display:"flex",flexDirection:"row"},children:e.jsxs(T,{children:[t.label,!t.optional&&e.jsx("span",{style:{color:"red"},children:" *"}),t.description&&e.jsx(W,{style:{marginLeft:10},title:t.description})]})}),t.type==="credential"&&e.jsx(Q,{data:(s=a[n])!=null&&s.credentialId?{credential:a[n].credentialId}:{},inputParam:t,onSelect:h=>x(h,n,"credentialId")},(r=a[n])==null?void 0:r.credentialId),t.type==="boolean"&&e.jsx(J,{onChange:h=>x(h,n,t.name),value:a[n]?a[n][t.name]:t.default??!1}),(t.type==="string"||t.type==="password"||t.type==="number")&&e.jsx(Z,{inputParam:t,onChange:h=>x(h,n,t.name),value:a[n]?a[n][t.name]:t.default??""}),t.type==="options"&&e.jsx(P,{name:t.name,options:t.options,onSelect:h=>x(h,n,t.name),value:a[n]?a[n][t.name]:t.default??"choose an option"})]},o)})]}),e.jsx(S,{style:{marginBottom:10,marginTop:10},disabled:n!=="none"&&!((w=a[n])!=null&&w.credentialId),variant:"contained",onClick:g,children:"Save"})]})};le.propTypes={dialogProps:y.object};export{ne as A,oe as C,ae as S,le as a,se as b};
