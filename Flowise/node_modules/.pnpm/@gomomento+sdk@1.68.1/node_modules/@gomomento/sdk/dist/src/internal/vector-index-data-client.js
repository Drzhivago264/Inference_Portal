"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.VectorIndexDataClient = void 0;
const package_json_1 = require("../../package.json");
const sdk_core_1 = require("@gomomento/sdk-core");
const grpc_js_1 = require("@grpc/grpc-js");
const vectorindex_1 = require("@gomomento/generated-types/dist/vectorindex");
const headers_interceptor_1 = require("./grpc/headers-interceptor");
const client_timeout_interceptor_1 = require("./grpc/client-timeout-interceptor");
const cache_service_error_mapper_1 = require("../errors/cache-service-error-mapper");
const utils_1 = require("@gomomento/sdk-core/dist/src/internal/utils");
const errors_1 = require("@gomomento/sdk-core/dist/src/errors");
const grpc_channel_options_1 = require("./grpc/grpc-channel-options");
class VectorIndexDataClient {
    constructor(props) {
        this.configuration = props.configuration;
        this.credentialProvider = props.credentialProvider;
        this.logger = this.configuration.getLoggerFactory().getLogger(this);
        this.cacheServiceErrorMapper = new cache_service_error_mapper_1.CacheServiceErrorMapper(this.configuration.getThrowOnErrors());
        const grpcConfig = this.configuration
            .getTransportStrategy()
            .getGrpcConfig();
        this.requestTimeoutMs = grpcConfig.getDeadlineMillis();
        this.validateRequestTimeout(this.requestTimeoutMs);
        this.logger.debug(`Creating vector index client using endpoint: '${this.credentialProvider.getVectorEndpoint()}'`);
        const channelOptions = (0, grpc_channel_options_1.grpcChannelOptionsFromGrpcConfig)(grpcConfig);
        this.client = new vectorindex_1.vectorindex.VectorIndexClient(this.credentialProvider.getVectorEndpoint(), grpc_js_1.ChannelCredentials.createSsl(), channelOptions);
        this.interceptors = this.initializeInterceptors(this.configuration.getLoggerFactory());
    }
    async countItems(indexName) {
        try {
            (0, utils_1.validateIndexName)(indexName);
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorCountItems.Error(err));
        }
        return await this.sendCountItems(indexName);
    }
    async sendCountItems(indexName) {
        const request = new vectorindex_1.vectorindex._CountItemsRequest({
            index_name: indexName,
            all: new vectorindex_1.vectorindex._CountItemsRequest.All(),
        });
        return await new Promise((resolve, reject) => {
            this.client.CountItems(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorCountItems.Success(resp.item_count));
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorCountItems.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async upsertItemBatch(indexName, items) {
        let request;
        try {
            (0, utils_1.validateIndexName)(indexName);
            // Create the request here to catch any metadata validation errors.
            request = VectorIndexDataClient.buildUpsertItemBatchRequest(indexName, items);
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorUpsertItemBatch.Error(err));
        }
        return await this.sendUpsertItemBatch(indexName, request);
    }
    static buildUpsertItemBatchRequest(indexName, items) {
        return new vectorindex_1.vectorindex._UpsertItemBatchRequest({
            index_name: indexName,
            items: items.map(item => {
                return new vectorindex_1.vectorindex._Item({
                    id: item.id,
                    vector: new vectorindex_1.vectorindex._Vector({ elements: item.vector }),
                    metadata: VectorIndexDataClient.convertItemMetadataToProtobufMetadata(item),
                });
            }),
        });
    }
    static convertItemMetadataToProtobufMetadata(item) {
        if (item.metadata === undefined) {
            return [];
        }
        return Object.entries(item.metadata).map(([key, value]) => {
            if (typeof value === 'string') {
                return new vectorindex_1.vectorindex._Metadata({
                    field: key,
                    string_value: value,
                });
            }
            else if (typeof value === 'number') {
                if (Number.isInteger(value)) {
                    return new vectorindex_1.vectorindex._Metadata({
                        field: key,
                        integer_value: value,
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._Metadata({
                        field: key,
                        double_value: value,
                    });
                }
            }
            else if (typeof value === 'boolean') {
                return new vectorindex_1.vectorindex._Metadata({
                    field: key,
                    boolean_value: value,
                });
            }
            else if (Array.isArray(value) &&
                value.every(item => typeof item === 'string')) {
                return new vectorindex_1.vectorindex._Metadata({
                    field: key,
                    list_of_strings_value: new vectorindex_1.vectorindex._Metadata._ListOfStrings({
                        values: value,
                    }),
                });
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Metadata value for field '${key}' is not a valid type. Value is of type '${typeof value} and is not a string, number, boolean, or array of strings.'`);
            }
        });
    }
    async sendUpsertItemBatch(indexName, request) {
        return await new Promise((resolve, reject) => {
            this.client.UpsertItemBatch(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorUpsertItemBatch.Success());
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorUpsertItemBatch.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async deleteItemBatch(indexName, filter) {
        try {
            (0, utils_1.validateIndexName)(indexName);
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorDeleteItemBatch.Error(err));
        }
        return await this.sendDeleteItemBatch(indexName, filter);
    }
    async sendDeleteItemBatch(indexName, filter) {
        const filterProtobuf = filter instanceof sdk_core_1.VectorFilterExpression
            ? VectorIndexDataClient.buildFilterExpression(filter)
            : VectorIndexDataClient.idsToFilterExpression(filter);
        const request = new vectorindex_1.vectorindex._DeleteItemBatchRequest({
            index_name: indexName,
            filter: filterProtobuf,
        });
        return await new Promise((resolve, reject) => {
            this.client.DeleteItemBatch(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorDeleteItemBatch.Success());
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorDeleteItemBatch.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async search(indexName, queryVector, options) {
        try {
            (0, utils_1.validateIndexName)(indexName);
            if ((options === null || options === void 0 ? void 0 : options.topK) !== undefined) {
                (0, utils_1.validateTopK)(options.topK);
            }
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorSearch.Error(err));
        }
        return await this.sendSearch(indexName, queryVector, options);
    }
    static buildMetadataRequest(options) {
        const metadataRequest = new vectorindex_1.vectorindex._MetadataRequest();
        if ((options === null || options === void 0 ? void 0 : options.metadataFields) === sdk_core_1.ALL_VECTOR_METADATA) {
            metadataRequest.all = new vectorindex_1.vectorindex._MetadataRequest.All();
        }
        else {
            metadataRequest.some = new vectorindex_1.vectorindex._MetadataRequest.Some({
                fields: (options === null || options === void 0 ? void 0 : options.metadataFields) === undefined ? [] : options.metadataFields,
            });
        }
        return metadataRequest;
    }
    static applyScoreThreshold(request, options) {
        if ((options === null || options === void 0 ? void 0 : options.scoreThreshold) !== undefined) {
            request.score_threshold = options.scoreThreshold;
        }
        else {
            request.no_score_threshold = new vectorindex_1.vectorindex._NoScoreThreshold();
        }
    }
    static buildFilterExpression(filterExpression) {
        if (filterExpression === undefined) {
            return undefined;
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterAndExpression) {
            return new vectorindex_1.vectorindex._FilterExpression({
                and_expression: new vectorindex_1.vectorindex._AndExpression({
                    first_expression: VectorIndexDataClient.buildFilterExpression(filterExpression.FirstExpression),
                    second_expression: VectorIndexDataClient.buildFilterExpression(filterExpression.SecondExpression),
                }),
            });
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterOrExpression) {
            return new vectorindex_1.vectorindex._FilterExpression({
                or_expression: new vectorindex_1.vectorindex._OrExpression({
                    first_expression: VectorIndexDataClient.buildFilterExpression(filterExpression.FirstExpression),
                    second_expression: VectorIndexDataClient.buildFilterExpression(filterExpression.SecondExpression),
                }),
            });
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterNotExpression) {
            return new vectorindex_1.vectorindex._FilterExpression({
                not_expression: new vectorindex_1.vectorindex._NotExpression({
                    expression_to_negate: VectorIndexDataClient.buildFilterExpression(filterExpression.Expression),
                }),
            });
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterEqualsExpression) {
            if (typeof filterExpression.Value === 'string') {
                return new vectorindex_1.vectorindex._FilterExpression({
                    equals_expression: new vectorindex_1.vectorindex._EqualsExpression({
                        field: filterExpression.Field,
                        string_value: filterExpression.Value,
                    }),
                });
            }
            else if (typeof filterExpression.Value === 'number') {
                if (Number.isInteger(filterExpression.Value)) {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        equals_expression: new vectorindex_1.vectorindex._EqualsExpression({
                            field: filterExpression.Field,
                            integer_value: filterExpression.Value,
                        }),
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        equals_expression: new vectorindex_1.vectorindex._EqualsExpression({
                            field: filterExpression.Field,
                            float_value: filterExpression.Value,
                        }),
                    });
                }
            }
            else if (typeof filterExpression.Value === 'boolean') {
                return new vectorindex_1.vectorindex._FilterExpression({
                    equals_expression: new vectorindex_1.vectorindex._EqualsExpression({
                        field: filterExpression.Field,
                        boolean_value: filterExpression.Value,
                    }),
                });
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a string, number, or boolean.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterGreaterThanExpression) {
            if (typeof filterExpression.Value === 'number') {
                if (Number.isInteger(filterExpression.Value)) {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        greater_than_expression: new vectorindex_1.vectorindex._GreaterThanExpression({
                            field: filterExpression.Field,
                            integer_value: filterExpression.Value,
                        }),
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        greater_than_expression: new vectorindex_1.vectorindex._GreaterThanExpression({
                            field: filterExpression.Field,
                            float_value: filterExpression.Value,
                        }),
                    });
                }
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a number.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterGreaterThanOrEqualExpression) {
            if (typeof filterExpression.Value === 'number') {
                if (Number.isInteger(filterExpression.Value)) {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        greater_than_or_equal_expression: new vectorindex_1.vectorindex._GreaterThanOrEqualExpression({
                            field: filterExpression.Field,
                            integer_value: filterExpression.Value,
                        }),
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        greater_than_or_equal_expression: new vectorindex_1.vectorindex._GreaterThanOrEqualExpression({
                            field: filterExpression.Field,
                            float_value: filterExpression.Value,
                        }),
                    });
                }
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a number.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterLessThanExpression) {
            if (typeof filterExpression.Value === 'number') {
                if (Number.isInteger(filterExpression.Value)) {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        less_than_expression: new vectorindex_1.vectorindex._LessThanExpression({
                            field: filterExpression.Field,
                            integer_value: filterExpression.Value,
                        }),
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        less_than_expression: new vectorindex_1.vectorindex._LessThanExpression({
                            field: filterExpression.Field,
                            float_value: filterExpression.Value,
                        }),
                    });
                }
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a number.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterLessThanOrEqualExpression) {
            if (typeof filterExpression.Value === 'number') {
                if (Number.isInteger(filterExpression.Value)) {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        less_than_or_equal_expression: new vectorindex_1.vectorindex._LessThanOrEqualExpression({
                            field: filterExpression.Field,
                            integer_value: filterExpression.Value,
                        }),
                    });
                }
                else {
                    return new vectorindex_1.vectorindex._FilterExpression({
                        less_than_or_equal_expression: new vectorindex_1.vectorindex._LessThanOrEqualExpression({
                            field: filterExpression.Field,
                            float_value: filterExpression.Value,
                        }),
                    });
                }
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a number.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterListContainsExpression) {
            if (typeof filterExpression.Value === 'string') {
                return new vectorindex_1.vectorindex._FilterExpression({
                    list_contains_expression: new vectorindex_1.vectorindex._ListContainsExpression({
                        field: filterExpression.Field,
                        string_value: filterExpression.Value,
                    }),
                });
            }
            else {
                throw new sdk_core_1.InvalidArgumentError(`Filter value for field '${filterExpression.Field}' is not a valid type. Value is of type '${typeof filterExpression.Value} and is not a string.'`);
            }
        }
        else if (filterExpression instanceof sdk_core_1.vectorFilters.VectorFilterIdInSetExpression) {
            return new vectorindex_1.vectorindex._FilterExpression({
                id_in_set_expression: new vectorindex_1.vectorindex._IdInSetExpression({
                    ids: filterExpression.Ids,
                }),
            });
        }
        throw new sdk_core_1.InvalidArgumentError('Filter expression is not a valid type.');
    }
    /**
     * Convert a list of ids to a filter expression that matches the ids.
     * @param ids
     * @private
     */
    static idsToFilterExpression(ids) {
        return new vectorindex_1.vectorindex._FilterExpression({
            id_in_set_expression: new vectorindex_1.vectorindex._IdInSetExpression({
                ids: ids,
            }),
        });
    }
    static deserializeMetadata(metadata, errorCallback) {
        return metadata.reduce((acc, metadata) => {
            const field = metadata.field;
            switch (metadata.value) {
                case 'string_value':
                    acc[field] = metadata.string_value;
                    break;
                case 'integer_value':
                    acc[field] = metadata.integer_value;
                    break;
                case 'double_value':
                    acc[field] = metadata.double_value;
                    break;
                case 'boolean_value':
                    acc[field] = metadata.boolean_value;
                    break;
                case 'list_of_strings_value':
                    acc[field] = metadata.list_of_strings_value.values;
                    break;
                default:
                    errorCallback();
                    break;
            }
            return acc;
        }, {});
    }
    async sendSearch(indexName, queryVector, options) {
        var _a;
        const request = new vectorindex_1.vectorindex._SearchRequest({
            index_name: indexName,
            query_vector: new vectorindex_1.vectorindex._Vector({ elements: queryVector }),
            top_k: (_a = options === null || options === void 0 ? void 0 : options.topK) !== null && _a !== void 0 ? _a : sdk_core_1.VECTOR_DEFAULT_TOPK,
            metadata_fields: VectorIndexDataClient.buildMetadataRequest(options),
            filter: VectorIndexDataClient.buildFilterExpression(options === null || options === void 0 ? void 0 : options.filter),
        });
        VectorIndexDataClient.applyScoreThreshold(request, options);
        return await new Promise((resolve, reject) => {
            this.client.Search(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorSearch.Success(resp.hits.map(hit => ({
                        id: hit.id,
                        score: hit.score,
                        metadata: VectorIndexDataClient.deserializeMetadata(hit.metadata, () => resolve(new sdk_core_1.VectorSearch.Error(new errors_1.UnknownError('Search responded with an unknown result')))),
                    }))));
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorSearch.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async searchAndFetchVectors(indexName, queryVector, options) {
        try {
            (0, utils_1.validateIndexName)(indexName);
            if ((options === null || options === void 0 ? void 0 : options.topK) !== undefined) {
                (0, utils_1.validateTopK)(options.topK);
            }
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorSearchAndFetchVectors.Error(err));
        }
        return await this.sendSearchAndFetchVectors(indexName, queryVector, options);
    }
    async sendSearchAndFetchVectors(indexName, queryVector, options) {
        var _a;
        const request = new vectorindex_1.vectorindex._SearchAndFetchVectorsRequest({
            index_name: indexName,
            query_vector: new vectorindex_1.vectorindex._Vector({ elements: queryVector }),
            top_k: (_a = options === null || options === void 0 ? void 0 : options.topK) !== null && _a !== void 0 ? _a : sdk_core_1.VECTOR_DEFAULT_TOPK,
            metadata_fields: VectorIndexDataClient.buildMetadataRequest(options),
            filter: VectorIndexDataClient.buildFilterExpression(options === null || options === void 0 ? void 0 : options.filter),
        });
        VectorIndexDataClient.applyScoreThreshold(request, options);
        return await new Promise((resolve, reject) => {
            this.client.SearchAndFetchVectors(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorSearchAndFetchVectors.Success(resp.hits.map(hit => ({
                        id: hit.id,
                        score: hit.score,
                        vector: hit.vector.elements,
                        metadata: VectorIndexDataClient.deserializeMetadata(hit.metadata, () => resolve(new sdk_core_1.VectorSearchAndFetchVectors.Error(new errors_1.UnknownError('SearchAndFetchVectors responded with an unknown result')))),
                    }))));
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorSearchAndFetchVectors.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async getItemBatch(indexName, filter) {
        try {
            (0, utils_1.validateIndexName)(indexName);
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorGetItemBatch.Error(err));
        }
        return await this.sendGetItemBatch(indexName, filter);
    }
    async sendGetItemBatch(indexName, filter) {
        const request = new vectorindex_1.vectorindex._GetItemBatchRequest({
            index_name: indexName,
            filter: VectorIndexDataClient.idsToFilterExpression(filter),
            metadata_fields: VectorIndexDataClient.buildMetadataRequest({
                metadataFields: sdk_core_1.ALL_VECTOR_METADATA,
            }),
        });
        return await new Promise((resolve, reject) => {
            this.client.GetItemBatch(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorGetItemBatch.Success(resp.item_response.reduce((acc, itemResponse) => {
                        acc[itemResponse.id] = {
                            id: itemResponse.id,
                            vector: itemResponse.vector.elements,
                            metadata: VectorIndexDataClient.deserializeMetadata(itemResponse.metadata, () => resolve(new sdk_core_1.VectorGetItemBatch.Error(new errors_1.UnknownError('GetItemBatch responded with an unknown result')))),
                        };
                        return acc;
                    }, {})));
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorGetItemBatch.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    async getItemMetadataBatch(indexName, filter) {
        try {
            (0, utils_1.validateIndexName)(indexName);
        }
        catch (err) {
            return this.cacheServiceErrorMapper.returnOrThrowError(err, err => new sdk_core_1.VectorGetItemMetadataBatch.Error(err));
        }
        return await this.sendGetItemMetadataBatch(indexName, filter);
    }
    async sendGetItemMetadataBatch(indexName, filter) {
        const request = new vectorindex_1.vectorindex._GetItemMetadataBatchRequest({
            index_name: indexName,
            filter: VectorIndexDataClient.idsToFilterExpression(filter),
            metadata_fields: VectorIndexDataClient.buildMetadataRequest({
                metadataFields: sdk_core_1.ALL_VECTOR_METADATA,
            }),
        });
        return await new Promise((resolve, reject) => {
            this.client.GetItemMetadataBatch(request, { interceptors: this.interceptors }, (err, resp) => {
                if (resp) {
                    resolve(new sdk_core_1.VectorGetItemMetadataBatch.Success(resp.item_metadata_response.reduce((acc, itemResponse) => {
                        acc[itemResponse.id] =
                            VectorIndexDataClient.deserializeMetadata(itemResponse.metadata, () => resolve(new sdk_core_1.VectorGetItemMetadataBatch.Error(new errors_1.UnknownError('GetItemMetadataBatch responded with an unknown result'))));
                        return acc;
                    }, {})));
                }
                else {
                    this.cacheServiceErrorMapper.resolveOrRejectError({
                        err: err,
                        errorResponseFactoryFn: e => new sdk_core_1.VectorGetItemMetadataBatch.Error(e),
                        resolveFn: resolve,
                        rejectFn: reject,
                    });
                }
            });
        });
    }
    validateRequestTimeout(timeout) {
        this.logger.debug(`Request timeout ms: ${String(timeout)}`);
        if (timeout !== undefined && timeout <= 0) {
            throw new sdk_core_1.InvalidArgumentError('request timeout must be greater than zero.');
        }
    }
    initializeInterceptors(_loggerFactory) {
        const headers = [
            new headers_interceptor_1.Header('Authorization', this.credentialProvider.getAuthToken()),
            new headers_interceptor_1.Header('Agent', `nodejs:${package_json_1.version}`),
        ];
        return [
            new headers_interceptor_1.HeaderInterceptorProvider(headers).createHeadersInterceptor(),
            (0, client_timeout_interceptor_1.ClientTimeoutInterceptor)(this.requestTimeoutMs),
        ];
    }
}
exports.VectorIndexDataClient = VectorIndexDataClient;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoidmVjdG9yLWluZGV4LWRhdGEtY2xpZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2ludGVybmFsL3ZlY3Rvci1pbmRleC1kYXRhLWNsaWVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7QUFBQSxxREFBMkM7QUFFM0Msa0RBb0I2QjtBQUU3QiwyQ0FBOEQ7QUFDOUQsNkVBQXdFO0FBQ3hFLG9FQUE2RTtBQUM3RSxrRkFBMkU7QUFDM0UscUZBQTZFO0FBQzdFLHVFQUdxRDtBQUNyRCxnRUFBaUU7QUFFakUsc0VBQTZFO0FBRTdFLE1BQWEscUJBQXFCO0lBU2hDLFlBQVksS0FBdUM7UUFDakQsSUFBSSxDQUFDLGFBQWEsR0FBRyxLQUFLLENBQUMsYUFBYSxDQUFDO1FBQ3pDLElBQUksQ0FBQyxrQkFBa0IsR0FBRyxLQUFLLENBQUMsa0JBQWtCLENBQUM7UUFDbkQsSUFBSSxDQUFDLE1BQU0sR0FBRyxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixFQUFFLENBQUMsU0FBUyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3BFLElBQUksQ0FBQyx1QkFBdUIsR0FBRyxJQUFJLG9EQUF1QixDQUN4RCxJQUFJLENBQUMsYUFBYSxDQUFDLGdCQUFnQixFQUFFLENBQ3RDLENBQUM7UUFDRixNQUFNLFVBQVUsR0FBRyxJQUFJLENBQUMsYUFBYTthQUNsQyxvQkFBb0IsRUFBRTthQUN0QixhQUFhLEVBQUUsQ0FBQztRQUVuQixJQUFJLENBQUMsZ0JBQWdCLEdBQUcsVUFBVSxDQUFDLGlCQUFpQixFQUFFLENBQUM7UUFDdkQsSUFBSSxDQUFDLHNCQUFzQixDQUFDLElBQUksQ0FBQyxnQkFBZ0IsQ0FBQyxDQUFDO1FBQ25ELElBQUksQ0FBQyxNQUFNLENBQUMsS0FBSyxDQUNmLGlEQUFpRCxJQUFJLENBQUMsa0JBQWtCLENBQUMsaUJBQWlCLEVBQUUsR0FBRyxDQUNoRyxDQUFDO1FBRUYsTUFBTSxjQUFjLEdBQUcsSUFBQSx1REFB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IjpbImltcG9ydCB7dmVyc2lvbn0gZnJvbSAnLi4vLi4vcGFja2FnZS5qc29uJztcbmltcG9ydCB7SVZlY3RvckluZGV4RGF0YUNsaWVudH0gZnJvbSAnQGdvbW9tZW50by9zZGstY29yZS9kaXN0L3NyYy9pbnRlcm5hbC9jbGllbnRzL3ZlY3Rvci9JVmVjdG9ySW5kZXhEYXRhQ2xpZW50JztcbmltcG9ydCB7XG4gIEFMTF9WRUNUT1JfTUVUQURBVEEsXG4gIENyZWRlbnRpYWxQcm92aWRlcixcbiAgSW52YWxpZEFyZ3VtZW50RXJyb3IsXG4gIE1vbWVudG9Mb2dnZXIsXG4gIE1vbWVudG9Mb2dnZXJGYWN0b3J5LFxuICBTZWFyY2hPcHRpb25zLFxuICBWRUNUT1JfREVGQVVMVF9UT1BLLFxuICBWZWN0b3JDb3VudEl0ZW1zLFxuICBWZWN0b3JEZWxldGVJdGVtQmF0Y2gsXG4gIFZlY3RvckZpbHRlckV4cHJlc3Npb24sXG4gIHZlY3RvckZpbHRlcnMgYXMgRixcbiAgVmVjdG9yR2V0SXRlbUJhdGNoLFxuICBWZWN0b3JHZXRJdGVtTWV0YWRhdGFCYXRjaCxcbiAgVmVjdG9ySW5kZXhJdGVtLFxuICBWZWN0b3JJbmRleE1ldGFkYXRhLFxuICBWZWN0b3JJbmRleFN0b3JlZEl0ZW0sXG4gIFZlY3RvclNlYXJjaCxcbiAgVmVjdG9yU2VhcmNoQW5kRmV0Y2hWZWN0b3JzLFxuICBWZWN0b3JVcHNlcnRJdGVtQmF0Y2gsXG59IGZyb20gJ0Bnb21vbWVudG8vc2RrLWNvcmUnO1xuaW1wb3J0IHtWZWN0b3JJbmRleENvbmZpZ3VyYXRpb259IGZyb20gJy4uL2NvbmZpZy92ZWN0b3ItaW5kZXgtY29uZmlndXJhdGlvbic7XG5pbXBvcnQge0NoYW5uZWxDcmVkZW50aWFscywgSW50ZXJjZXB0b3J9IGZyb20gJ0BncnBjL2dycGMtanMnO1xuaW1wb3J0IHt2ZWN0b3JpbmRleH0gZnJvbSAnQGdvbW9tZW50by9nZW5lcmF0ZWQtdHlwZXMvZGlzdC92ZWN0b3JpbmRleCc7XG5pbXBvcnQge0hlYWRlciwgSGVhZGVySW50ZXJjZXB0b3JQcm92aWRlcn0gZnJvbSAnLi9ncnBjL2hlYWRlcnMtaW50ZXJjZXB0b3InO1xuaW1wb3J0IHtDbGllbnRUaW1lb3V0SW50ZXJjZXB0b3J9IGZyb20gJy4vZ3JwYy9jbGllbnQtdGltZW91dC1pbnRlcmNlcHRvcic7XG5pbXBvcnQge0NhY2hlU2VydmljZUVycm9yTWFwcGVyfSBmcm9tICcuLi9lcnJvcnMvY2FjaGUtc2VydmljZS1lcnJvci1tYXBwZXInO1xuaW1wb3J0IHtcbiAgdmFsaWRhdGVJbmRleE5hbWUsXG4gIHZhbGlkYXRlVG9wSyxcbn0gZnJvbSAnQGdvbW9tZW50by9zZGstY29yZS9kaXN0L3NyYy9pbnRlcm5hbC91dGlscyc7XG5pbXBvcnQge1Vua25vd25FcnJvcn0gZnJvbSAnQGdvbW9tZW50by9zZGstY29yZS9kaXN0L3NyYy9lcnJvcnMnO1xuaW1wb3J0IHtWZWN0b3JJbmRleENsaWVudFByb3BzV2l0aENvbmZpZ30gZnJvbSAnLi92ZWN0b3ItaW5kZXgtY2xpZW50LXByb3BzLXdpdGgtY29uZmlnJztcbmltcG9ydCB7Z3JwY0NoYW5uZWxPcHRpb25zRnJvbUdycGNDb25maWd9IGZyb20gJy4vZ3JwYy9ncnBjLWNoYW5uZWwtb3B0aW9ucyc7XG5cbmV4cG9ydCBjbGFzcyBWZWN0b3JJbmRleERhdGFDbGllbnQgaW1wbGVtZW50cyBJVmVjdG9ySW5kZXhEYXRhQ2xpZW50IHtcbiAgcHJpdmF0ZSByZWFkb25seSBjb25maWd1cmF0aW9uOiBWZWN0b3JJbmRleENvbmZpZ3VyYXRpb247XG4gIHByaXZhdGUgcmVhZG9ubHkgY3JlZGVudGlhbFByb3ZpZGVyOiBDcmVkZW50aWFsUHJvdmlkZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgbG9nZ2VyOiBNb21lbnRvTG9nZ2VyO1xuICBwcml2YXRlIHJlYWRvbmx5IGNhY2hlU2VydmljZUVycm9yTWFwcGVyOiBDYWNoZVNlcnZpY2VFcnJvck1hcHBlcjtcbiAgcHJpdmF0ZSByZWFkb25seSByZXF1ZXN0VGltZW91dE1zOiBudW1iZXI7XG4gIHByaXZhdGUgcmVhZG9ubHkgY2xpZW50OiB2ZWN0b3JpbmRleC5WZWN0b3JJbmRleENsaWVudDtcbiAgcHJpdmF0ZSByZWFkb25seSBpbnRlcmNlcHRvcnM6IEludGVyY2VwdG9yW107XG5cbiAgY29uc3RydWN0b3IocHJvcHM6IFZlY3RvckluZGV4Q2xpZW50UHJvcHNXaXRoQ29uZmlnKSB7XG4gICAgdGhpcy5jb25maWd1cmF0aW9uID0gcHJvcHMuY29uZmlndXJhdGlvbjtcbiAgICB0aGlzLmNyZWRlbnRpYWxQcm92aWRlciA9IHByb3BzLmNyZWRlbnRpYWxQcm92aWRlcjtcbiAgICB0aGlzLmxvZ2dlciA9IHRoaXMuY29uZmlndXJhdGlvbi5nZXRMb2dnZXJGYWN0b3J5KCkuZ2V0TG9nZ2VyKHRoaXMpO1xuICAgIHRoaXMuY2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIgPSBuZXcgQ2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIoXG4gICAgICB0aGlzLmNvbmZpZ3VyYXRpb24uZ2V0VGhyb3dPbkVycm9ycygpXG4gICAgKTtcbiAgICBjb25zdCBncnBjQ29uZmlnID0gdGhpcy5jb25maWd1cmF0aW9uXG4gICAgICAuZ2V0VHJhbnNwb3J0U3RyYXRlZ3koKVxuICAgICAgLmdldEdycGNDb25maWcoKTtcblxuICAgIHRoaXMucmVxdWVzdFRpbWVvdXRNcyA9IGdycGNDb25maWcuZ2V0RGVhZGxpbmVNaWxsaXMoKTtcbiAgICB0aGlzLnZhbGlkYXRlUmVxdWVzdFRpbWVvdXQodGhpcy5yZXF1ZXN0VGltZW91dE1zKTtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhcbiAgICAgIGBDcmVhdGluZyB2ZWN0b3IgaW5kZXggY2xpZW50IHVzaW5nIGVuZHBvaW50OiAnJHt0aGlzLmNyZWRlbnRpYWxQcm92aWRlci5nZXRWZWN0b3JFbmRwb2ludCgpfSdgXG4gICAgKTtcblxuICAgIGNvbnN0IGNoYW5uZWxPcHRpb25zID0gZ3JwY0NoYW5uZWxPcHRpb25zRnJvbUdycGNDb25maWcoZ3JwY0NvbmZpZyk7XG5cbiAgICB0aGlzLmNsaWVudCA9IG5ldyB2ZWN0b3JpbmRleC5WZWN0b3JJbmRleENsaWVudChcbiAgICAgIHRoaXMuY3JlZGVudGlhbFByb3ZpZGVyLmdldFZlY3RvckVuZHBvaW50KCksXG4gICAgICBDaGFubmVsQ3JlZGVudGlhbHMuY3JlYXRlU3NsKCksXG4gICAgICBjaGFubmVsT3B0aW9uc1xuICAgICk7XG5cbiAgICB0aGlzLmludGVyY2VwdG9ycyA9IHRoaXMuaW5pdGlhbGl6ZUludGVyY2VwdG9ycyhcbiAgICAgIHRoaXMuY29uZmlndXJhdGlvbi5nZXRMb2dnZXJGYWN0b3J5KClcbiAgICApO1xuICB9XG5cbiAgcHVibGljIGFzeW5jIGNvdW50SXRlbXMoXG4gICAgaW5kZXhOYW1lOiBzdHJpbmdcbiAgKTogUHJvbWlzZTxWZWN0b3JDb3VudEl0ZW1zLlJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIHZhbGlkYXRlSW5kZXhOYW1lKGluZGV4TmFtZSk7XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXR1cm5PclRocm93RXJyb3IoXG4gICAgICAgIGVyciBhcyBFcnJvcixcbiAgICAgICAgZXJyID0+IG5ldyBWZWN0b3JDb3VudEl0ZW1zLkVycm9yKGVycilcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRDb3VudEl0ZW1zKGluZGV4TmFtZSk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNlbmRDb3VudEl0ZW1zKFxuICAgIGluZGV4TmFtZTogc3RyaW5nXG4gICk6IFByb21pc2U8VmVjdG9yQ291bnRJdGVtcy5SZXNwb25zZT4ge1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgdmVjdG9yaW5kZXguX0NvdW50SXRlbXNSZXF1ZXN0KHtcbiAgICAgIGluZGV4X25hbWU6IGluZGV4TmFtZSxcbiAgICAgIGFsbDogbmV3IHZlY3RvcmluZGV4Ll9Db3VudEl0ZW1zUmVxdWVzdC5BbGwoKSxcbiAgICB9KTtcbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuQ291bnRJdGVtcyhcbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICAge2ludGVyY2VwdG9yczogdGhpcy5pbnRlcmNlcHRvcnN9LFxuICAgICAgICAoZXJyLCByZXNwKSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3ApIHtcbiAgICAgICAgICAgIHJlc29sdmUobmV3IFZlY3RvckNvdW50SXRlbXMuU3VjY2VzcyhyZXNwLml0ZW1fY291bnQpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXNvbHZlT3JSZWplY3RFcnJvcih7XG4gICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlRmFjdG9yeUZuOiBlID0+IG5ldyBWZWN0b3JDb3VudEl0ZW1zLkVycm9yKGUpLFxuICAgICAgICAgICAgICByZXNvbHZlRm46IHJlc29sdmUsXG4gICAgICAgICAgICAgIHJlamVjdEZuOiByZWplY3QsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgdXBzZXJ0SXRlbUJhdGNoKFxuICAgIGluZGV4TmFtZTogc3RyaW5nLFxuICAgIGl0ZW1zOiBBcnJheTxWZWN0b3JJbmRleEl0ZW0+XG4gICk6IFByb21pc2U8VmVjdG9yVXBzZXJ0SXRlbUJhdGNoLlJlc3BvbnNlPiB7XG4gICAgbGV0IHJlcXVlc3Q6IHZlY3RvcmluZGV4Ll9VcHNlcnRJdGVtQmF0Y2hSZXF1ZXN0O1xuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZUluZGV4TmFtZShpbmRleE5hbWUpO1xuXG4gICAgICAvLyBDcmVhdGUgdGhlIHJlcXVlc3QgaGVyZSB0byBjYXRjaCBhbnkgbWV0YWRhdGEgdmFsaWRhdGlvbiBlcnJvcnMuXG4gICAgICByZXF1ZXN0ID0gVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmJ1aWxkVXBzZXJ0SXRlbUJhdGNoUmVxdWVzdChcbiAgICAgICAgaW5kZXhOYW1lLFxuICAgICAgICBpdGVtc1xuICAgICAgKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB0aGlzLmNhY2hlU2VydmljZUVycm9yTWFwcGVyLnJldHVybk9yVGhyb3dFcnJvcihcbiAgICAgICAgZXJyIGFzIEVycm9yLFxuICAgICAgICBlcnIgPT4gbmV3IFZlY3RvclVwc2VydEl0ZW1CYXRjaC5FcnJvcihlcnIpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kVXBzZXJ0SXRlbUJhdGNoKGluZGV4TmFtZSwgcmVxdWVzdCk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBidWlsZFVwc2VydEl0ZW1CYXRjaFJlcXVlc3QoXG4gICAgaW5kZXhOYW1lOiBzdHJpbmcsXG4gICAgaXRlbXM6IEFycmF5PFZlY3RvckluZGV4SXRlbT5cbiAgKTogdmVjdG9yaW5kZXguX1Vwc2VydEl0ZW1CYXRjaFJlcXVlc3Qge1xuICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX1Vwc2VydEl0ZW1CYXRjaFJlcXVlc3Qoe1xuICAgICAgaW5kZXhfbmFtZTogaW5kZXhOYW1lLFxuICAgICAgaXRlbXM6IGl0ZW1zLm1hcChpdGVtID0+IHtcbiAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fSXRlbSh7XG4gICAgICAgICAgaWQ6IGl0ZW0uaWQsXG4gICAgICAgICAgdmVjdG9yOiBuZXcgdmVjdG9yaW5kZXguX1ZlY3Rvcih7ZWxlbWVudHM6IGl0ZW0udmVjdG9yfSksXG4gICAgICAgICAgbWV0YWRhdGE6XG4gICAgICAgICAgICBWZWN0b3JJbmRleERhdGFDbGllbnQuY29udmVydEl0ZW1NZXRhZGF0YVRvUHJvdG9idWZNZXRhZGF0YShpdGVtKSxcbiAgICAgICAgfSk7XG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGNvbnZlcnRJdGVtTWV0YWRhdGFUb1Byb3RvYnVmTWV0YWRhdGEoXG4gICAgaXRlbTogVmVjdG9ySW5kZXhJdGVtXG4gICk6IHZlY3RvcmluZGV4Ll9NZXRhZGF0YVtdIHtcbiAgICBpZiAoaXRlbS5tZXRhZGF0YSA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gW107XG4gICAgfVxuICAgIHJldHVybiBPYmplY3QuZW50cmllcyhpdGVtLm1ldGFkYXRhKS5tYXAoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fTWV0YWRhdGEoe1xuICAgICAgICAgIGZpZWxkOiBrZXksXG4gICAgICAgICAgc3RyaW5nX3ZhbHVlOiB2YWx1ZSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ251bWJlcicpIHtcbiAgICAgICAgaWYgKE51bWJlci5pc0ludGVnZXIodmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fTWV0YWRhdGEoe1xuICAgICAgICAgICAgZmllbGQ6IGtleSxcbiAgICAgICAgICAgIGludGVnZXJfdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX01ldGFkYXRhKHtcbiAgICAgICAgICAgIGZpZWxkOiBrZXksXG4gICAgICAgICAgICBkb3VibGVfdmFsdWU6IHZhbHVlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ2Jvb2xlYW4nKSB7XG4gICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX01ldGFkYXRhKHtcbiAgICAgICAgICBmaWVsZDoga2V5LFxuICAgICAgICAgIGJvb2xlYW5fdmFsdWU6IHZhbHVlLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIEFycmF5LmlzQXJyYXkodmFsdWUpICYmXG4gICAgICAgIHZhbHVlLmV2ZXJ5KGl0ZW0gPT4gdHlwZW9mIGl0ZW0gPT09ICdzdHJpbmcnKVxuICAgICAgKSB7XG4gICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX01ldGFkYXRhKHtcbiAgICAgICAgICBmaWVsZDoga2V5LFxuICAgICAgICAgIGxpc3Rfb2Zfc3RyaW5nc192YWx1ZTogbmV3IHZlY3RvcmluZGV4Ll9NZXRhZGF0YS5fTGlzdE9mU3RyaW5ncyh7XG4gICAgICAgICAgICB2YWx1ZXM6IHZhbHVlLFxuICAgICAgICAgIH0pLFxuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRocm93IG5ldyBJbnZhbGlkQXJndW1lbnRFcnJvcihcbiAgICAgICAgICBgTWV0YWRhdGEgdmFsdWUgZm9yIGZpZWxkICcke2tleX0nIGlzIG5vdCBhIHZhbGlkIHR5cGUuIFZhbHVlIGlzIG9mIHR5cGUgJyR7dHlwZW9mIHZhbHVlfSBhbmQgaXMgbm90IGEgc3RyaW5nLCBudW1iZXIsIGJvb2xlYW4sIG9yIGFycmF5IG9mIHN0cmluZ3MuJ2BcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2VuZFVwc2VydEl0ZW1CYXRjaChcbiAgICBpbmRleE5hbWU6IHN0cmluZyxcbiAgICByZXF1ZXN0OiB2ZWN0b3JpbmRleC5fVXBzZXJ0SXRlbUJhdGNoUmVxdWVzdFxuICApOiBQcm9taXNlPFZlY3RvclVwc2VydEl0ZW1CYXRjaC5SZXNwb25zZT4ge1xuICAgIHJldHVybiBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7XG4gICAgICB0aGlzLmNsaWVudC5VcHNlcnRJdGVtQmF0Y2goXG4gICAgICAgIHJlcXVlc3QsXG4gICAgICAgIHtpbnRlcmNlcHRvcnM6IHRoaXMuaW50ZXJjZXB0b3JzfSxcbiAgICAgICAgKGVyciwgcmVzcCkgPT4ge1xuICAgICAgICAgIGlmIChyZXNwKSB7XG4gICAgICAgICAgICByZXNvbHZlKG5ldyBWZWN0b3JVcHNlcnRJdGVtQmF0Y2guU3VjY2VzcygpKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXNvbHZlT3JSZWplY3RFcnJvcih7XG4gICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlRmFjdG9yeUZuOiBlID0+IG5ldyBWZWN0b3JVcHNlcnRJdGVtQmF0Y2guRXJyb3IoZSksXG4gICAgICAgICAgICAgIHJlc29sdmVGbjogcmVzb2x2ZSxcbiAgICAgICAgICAgICAgcmVqZWN0Rm46IHJlamVjdCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBkZWxldGVJdGVtQmF0Y2goXG4gICAgaW5kZXhOYW1lOiBzdHJpbmcsXG4gICAgZmlsdGVyOiBWZWN0b3JGaWx0ZXJFeHByZXNzaW9uIHwgQXJyYXk8c3RyaW5nPlxuICApOiBQcm9taXNlPFZlY3RvckRlbGV0ZUl0ZW1CYXRjaC5SZXNwb25zZT4ge1xuICAgIHRyeSB7XG4gICAgICB2YWxpZGF0ZUluZGV4TmFtZShpbmRleE5hbWUpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIHRoaXMuY2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIucmV0dXJuT3JUaHJvd0Vycm9yKFxuICAgICAgICBlcnIgYXMgRXJyb3IsXG4gICAgICAgIGVyciA9PiBuZXcgVmVjdG9yRGVsZXRlSXRlbUJhdGNoLkVycm9yKGVycilcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmREZWxldGVJdGVtQmF0Y2goaW5kZXhOYW1lLCBmaWx0ZXIpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZW5kRGVsZXRlSXRlbUJhdGNoKFxuICAgIGluZGV4TmFtZTogc3RyaW5nLFxuICAgIGZpbHRlcjogVmVjdG9yRmlsdGVyRXhwcmVzc2lvbiB8IEFycmF5PHN0cmluZz5cbiAgKTogUHJvbWlzZTxWZWN0b3JEZWxldGVJdGVtQmF0Y2guUmVzcG9uc2U+IHtcbiAgICBjb25zdCBmaWx0ZXJQcm90b2J1ZiA9XG4gICAgICBmaWx0ZXIgaW5zdGFuY2VvZiBWZWN0b3JGaWx0ZXJFeHByZXNzaW9uXG4gICAgICAgID8gVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmJ1aWxkRmlsdGVyRXhwcmVzc2lvbihmaWx0ZXIpXG4gICAgICAgIDogVmVjdG9ySW5kZXhEYXRhQ2xpZW50Lmlkc1RvRmlsdGVyRXhwcmVzc2lvbihmaWx0ZXIpO1xuICAgIGNvbnN0IHJlcXVlc3QgPSBuZXcgdmVjdG9yaW5kZXguX0RlbGV0ZUl0ZW1CYXRjaFJlcXVlc3Qoe1xuICAgICAgaW5kZXhfbmFtZTogaW5kZXhOYW1lLFxuICAgICAgZmlsdGVyOiBmaWx0ZXJQcm90b2J1ZixcbiAgICB9KTtcbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuRGVsZXRlSXRlbUJhdGNoKFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICB7aW50ZXJjZXB0b3JzOiB0aGlzLmludGVyY2VwdG9yc30sXG4gICAgICAgIChlcnIsIHJlc3ApID0+IHtcbiAgICAgICAgICBpZiAocmVzcCkge1xuICAgICAgICAgICAgcmVzb2x2ZShuZXcgVmVjdG9yRGVsZXRlSXRlbUJhdGNoLlN1Y2Nlc3MoKSk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIucmVzb2x2ZU9yUmVqZWN0RXJyb3Ioe1xuICAgICAgICAgICAgICBlcnI6IGVycixcbiAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZUZhY3RvcnlGbjogZSA9PiBuZXcgVmVjdG9yRGVsZXRlSXRlbUJhdGNoLkVycm9yKGUpLFxuICAgICAgICAgICAgICByZXNvbHZlRm46IHJlc29sdmUsXG4gICAgICAgICAgICAgIHJlamVjdEZuOiByZWplY3QsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgc2VhcmNoKFxuICAgIGluZGV4TmFtZTogc3RyaW5nLFxuICAgIHF1ZXJ5VmVjdG9yOiBBcnJheTxudW1iZXI+LFxuICAgIG9wdGlvbnM/OiBTZWFyY2hPcHRpb25zXG4gICk6IFByb21pc2U8VmVjdG9yU2VhcmNoLlJlc3BvbnNlPiB7XG4gICAgdHJ5IHtcbiAgICAgIHZhbGlkYXRlSW5kZXhOYW1lKGluZGV4TmFtZSk7XG4gICAgICBpZiAob3B0aW9ucz8udG9wSyAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICAgIHZhbGlkYXRlVG9wSyhvcHRpb25zLnRvcEspO1xuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmV0dXJuIHRoaXMuY2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIucmV0dXJuT3JUaHJvd0Vycm9yKFxuICAgICAgICBlcnIgYXMgRXJyb3IsXG4gICAgICAgIGVyciA9PiBuZXcgVmVjdG9yU2VhcmNoLkVycm9yKGVycilcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRTZWFyY2goaW5kZXhOYW1lLCBxdWVyeVZlY3Rvciwgb3B0aW9ucyk7XG4gIH1cblxuICBwcml2YXRlIHN0YXRpYyBidWlsZE1ldGFkYXRhUmVxdWVzdChcbiAgICBvcHRpb25zPzogU2VhcmNoT3B0aW9uc1xuICApOiB2ZWN0b3JpbmRleC5fTWV0YWRhdGFSZXF1ZXN0IHtcbiAgICBjb25zdCBtZXRhZGF0YVJlcXVlc3QgPSBuZXcgdmVjdG9yaW5kZXguX01ldGFkYXRhUmVxdWVzdCgpO1xuICAgIGlmIChvcHRpb25zPy5tZXRhZGF0YUZpZWxkcyA9PT0gQUxMX1ZFQ1RPUl9NRVRBREFUQSkge1xuICAgICAgbWV0YWRhdGFSZXF1ZXN0LmFsbCA9IG5ldyB2ZWN0b3JpbmRleC5fTWV0YWRhdGFSZXF1ZXN0LkFsbCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBtZXRhZGF0YVJlcXVlc3Quc29tZSA9IG5ldyB2ZWN0b3JpbmRleC5fTWV0YWRhdGFSZXF1ZXN0LlNvbWUoe1xuICAgICAgICBmaWVsZHM6XG4gICAgICAgICAgb3B0aW9ucz8ubWV0YWRhdGFGaWVsZHMgPT09IHVuZGVmaW5lZCA/IFtdIDogb3B0aW9ucy5tZXRhZGF0YUZpZWxkcyxcbiAgICAgIH0pO1xuICAgIH1cbiAgICByZXR1cm4gbWV0YWRhdGFSZXF1ZXN0O1xuICB9XG5cbiAgcHJpdmF0ZSBzdGF0aWMgYXBwbHlTY29yZVRocmVzaG9sZChcbiAgICByZXF1ZXN0OlxuICAgICAgfCB2ZWN0b3JpbmRleC5fU2VhcmNoUmVxdWVzdFxuICAgICAgfCB2ZWN0b3JpbmRleC5fU2VhcmNoQW5kRmV0Y2hWZWN0b3JzUmVxdWVzdCxcbiAgICBvcHRpb25zPzogU2VhcmNoT3B0aW9uc1xuICApOiB2b2lkIHtcbiAgICBpZiAob3B0aW9ucz8uc2NvcmVUaHJlc2hvbGQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcmVxdWVzdC5zY29yZV90aHJlc2hvbGQgPSBvcHRpb25zLnNjb3JlVGhyZXNob2xkO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXF1ZXN0Lm5vX3Njb3JlX3RocmVzaG9sZCA9IG5ldyB2ZWN0b3JpbmRleC5fTm9TY29yZVRocmVzaG9sZCgpO1xuICAgIH1cbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGJ1aWxkRmlsdGVyRXhwcmVzc2lvbihcbiAgICBmaWx0ZXJFeHByZXNzaW9uPzogRi5WZWN0b3JGaWx0ZXJFeHByZXNzaW9uXG4gICk6IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uIHwgdW5kZWZpbmVkIHtcbiAgICBpZiAoZmlsdGVyRXhwcmVzc2lvbiA9PT0gdW5kZWZpbmVkKSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyRXhwcmVzc2lvbiBpbnN0YW5jZW9mIEYuVmVjdG9yRmlsdGVyQW5kRXhwcmVzc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgIGFuZF9leHByZXNzaW9uOiBuZXcgdmVjdG9yaW5kZXguX0FuZEV4cHJlc3Npb24oe1xuICAgICAgICAgIGZpcnN0X2V4cHJlc3Npb246IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZEZpbHRlckV4cHJlc3Npb24oXG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpcnN0RXhwcmVzc2lvblxuICAgICAgICAgICksXG4gICAgICAgICAgc2Vjb25kX2V4cHJlc3Npb246IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZEZpbHRlckV4cHJlc3Npb24oXG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLlNlY29uZEV4cHJlc3Npb25cbiAgICAgICAgICApLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyRXhwcmVzc2lvbiBpbnN0YW5jZW9mIEYuVmVjdG9yRmlsdGVyT3JFeHByZXNzaW9uKSB7XG4gICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgb3JfZXhwcmVzc2lvbjogbmV3IHZlY3RvcmluZGV4Ll9PckV4cHJlc3Npb24oe1xuICAgICAgICAgIGZpcnN0X2V4cHJlc3Npb246IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZEZpbHRlckV4cHJlc3Npb24oXG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpcnN0RXhwcmVzc2lvblxuICAgICAgICAgICksXG4gICAgICAgICAgc2Vjb25kX2V4cHJlc3Npb246IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZEZpbHRlckV4cHJlc3Npb24oXG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLlNlY29uZEV4cHJlc3Npb25cbiAgICAgICAgICApLFxuICAgICAgICB9KSxcbiAgICAgIH0pO1xuICAgIH0gZWxzZSBpZiAoZmlsdGVyRXhwcmVzc2lvbiBpbnN0YW5jZW9mIEYuVmVjdG9yRmlsdGVyTm90RXhwcmVzc2lvbikge1xuICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgIG5vdF9leHByZXNzaW9uOiBuZXcgdmVjdG9yaW5kZXguX05vdEV4cHJlc3Npb24oe1xuICAgICAgICAgIGV4cHJlc3Npb25fdG9fbmVnYXRlOiBWZWN0b3JJbmRleERhdGFDbGllbnQuYnVpbGRGaWx0ZXJFeHByZXNzaW9uKFxuICAgICAgICAgICAgZmlsdGVyRXhwcmVzc2lvbi5FeHByZXNzaW9uXG4gICAgICAgICAgKSxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9IGVsc2UgaWYgKGZpbHRlckV4cHJlc3Npb24gaW5zdGFuY2VvZiBGLlZlY3RvckZpbHRlckVxdWFsc0V4cHJlc3Npb24pIHtcbiAgICAgIGlmICh0eXBlb2YgZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSA9PT0gJ3N0cmluZycpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgICAgZXF1YWxzX2V4cHJlc3Npb246IG5ldyB2ZWN0b3JpbmRleC5fRXF1YWxzRXhwcmVzc2lvbih7XG4gICAgICAgICAgICBmaWVsZDogZmlsdGVyRXhwcmVzc2lvbi5GaWVsZCxcbiAgICAgICAgICAgIHN0cmluZ192YWx1ZTogZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2UgaWYgKHR5cGVvZiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihmaWx0ZXJFeHByZXNzaW9uLlZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX0ZpbHRlckV4cHJlc3Npb24oe1xuICAgICAgICAgICAgZXF1YWxzX2V4cHJlc3Npb246IG5ldyB2ZWN0b3JpbmRleC5fRXF1YWxzRXhwcmVzc2lvbih7XG4gICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgICBpbnRlZ2VyX3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgICAgICBlcXVhbHNfZXhwcmVzc2lvbjogbmV3IHZlY3RvcmluZGV4Ll9FcXVhbHNFeHByZXNzaW9uKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGZpbHRlckV4cHJlc3Npb24uRmllbGQsXG4gICAgICAgICAgICAgIGZsb2F0X3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgfSksXG4gICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSBpZiAodHlwZW9mIGZpbHRlckV4cHJlc3Npb24uVmFsdWUgPT09ICdib29sZWFuJykge1xuICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICBlcXVhbHNfZXhwcmVzc2lvbjogbmV3IHZlY3RvcmluZGV4Ll9FcXVhbHNFeHByZXNzaW9uKHtcbiAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgYm9vbGVhbl92YWx1ZTogZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAgICAgYEZpbHRlciB2YWx1ZSBmb3IgZmllbGQgJyR7XG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkXG4gICAgICAgICAgfScgaXMgbm90IGEgdmFsaWQgdHlwZS4gVmFsdWUgaXMgb2YgdHlwZSAnJHt0eXBlb2YgZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZX0gYW5kIGlzIG5vdCBhIHN0cmluZywgbnVtYmVyLCBvciBib29sZWFuLidgXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfSBlbHNlIGlmIChcbiAgICAgIGZpbHRlckV4cHJlc3Npb24gaW5zdGFuY2VvZiBGLlZlY3RvckZpbHRlckdyZWF0ZXJUaGFuRXhwcmVzc2lvblxuICAgICkge1xuICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihmaWx0ZXJFeHByZXNzaW9uLlZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX0ZpbHRlckV4cHJlc3Npb24oe1xuICAgICAgICAgICAgZ3JlYXRlcl90aGFuX2V4cHJlc3Npb246IG5ldyB2ZWN0b3JpbmRleC5fR3JlYXRlclRoYW5FeHByZXNzaW9uKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGZpbHRlckV4cHJlc3Npb24uRmllbGQsXG4gICAgICAgICAgICAgIGludGVnZXJfdmFsdWU6IGZpbHRlckV4cHJlc3Npb24uVmFsdWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICAgIGdyZWF0ZXJfdGhhbl9leHByZXNzaW9uOiBuZXcgdmVjdG9yaW5kZXguX0dyZWF0ZXJUaGFuRXhwcmVzc2lvbih7XG4gICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgICBmbG9hdF92YWx1ZTogZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAgICAgYEZpbHRlciB2YWx1ZSBmb3IgZmllbGQgJyR7XG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkXG4gICAgICAgICAgfScgaXMgbm90IGEgdmFsaWQgdHlwZS4gVmFsdWUgaXMgb2YgdHlwZSAnJHt0eXBlb2YgZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZX0gYW5kIGlzIG5vdCBhIG51bWJlci4nYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBmaWx0ZXJFeHByZXNzaW9uIGluc3RhbmNlb2YgRi5WZWN0b3JGaWx0ZXJHcmVhdGVyVGhhbk9yRXF1YWxFeHByZXNzaW9uXG4gICAgKSB7XG4gICAgICBpZiAodHlwZW9mIGZpbHRlckV4cHJlc3Npb24uVmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGZpbHRlckV4cHJlc3Npb24uVmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgICAgICBncmVhdGVyX3RoYW5fb3JfZXF1YWxfZXhwcmVzc2lvbjpcbiAgICAgICAgICAgICAgbmV3IHZlY3RvcmluZGV4Ll9HcmVhdGVyVGhhbk9yRXF1YWxFeHByZXNzaW9uKHtcbiAgICAgICAgICAgICAgICBmaWVsZDogZmlsdGVyRXhwcmVzc2lvbi5GaWVsZCxcbiAgICAgICAgICAgICAgICBpbnRlZ2VyX3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICAgIGdyZWF0ZXJfdGhhbl9vcl9lcXVhbF9leHByZXNzaW9uOlxuICAgICAgICAgICAgICBuZXcgdmVjdG9yaW5kZXguX0dyZWF0ZXJUaGFuT3JFcXVhbEV4cHJlc3Npb24oe1xuICAgICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgICAgIGZsb2F0X3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAgIGBGaWx0ZXIgdmFsdWUgZm9yIGZpZWxkICcke1xuICAgICAgICAgICAgZmlsdGVyRXhwcmVzc2lvbi5GaWVsZFxuICAgICAgICAgIH0nIGlzIG5vdCBhIHZhbGlkIHR5cGUuIFZhbHVlIGlzIG9mIHR5cGUgJyR7dHlwZW9mIGZpbHRlckV4cHJlc3Npb24uVmFsdWV9IGFuZCBpcyBub3QgYSBudW1iZXIuJ2BcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKGZpbHRlckV4cHJlc3Npb24gaW5zdGFuY2VvZiBGLlZlY3RvckZpbHRlckxlc3NUaGFuRXhwcmVzc2lvbikge1xuICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlID09PSAnbnVtYmVyJykge1xuICAgICAgICBpZiAoTnVtYmVyLmlzSW50ZWdlcihmaWx0ZXJFeHByZXNzaW9uLlZhbHVlKSkge1xuICAgICAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX0ZpbHRlckV4cHJlc3Npb24oe1xuICAgICAgICAgICAgbGVzc190aGFuX2V4cHJlc3Npb246IG5ldyB2ZWN0b3JpbmRleC5fTGVzc1RoYW5FeHByZXNzaW9uKHtcbiAgICAgICAgICAgICAgZmllbGQ6IGZpbHRlckV4cHJlc3Npb24uRmllbGQsXG4gICAgICAgICAgICAgIGludGVnZXJfdmFsdWU6IGZpbHRlckV4cHJlc3Npb24uVmFsdWUsXG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICAgIGxlc3NfdGhhbl9leHByZXNzaW9uOiBuZXcgdmVjdG9yaW5kZXguX0xlc3NUaGFuRXhwcmVzc2lvbih7XG4gICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgICBmbG9hdF92YWx1ZTogZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSxcbiAgICAgICAgICAgIH0pLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAgICAgYEZpbHRlciB2YWx1ZSBmb3IgZmllbGQgJyR7XG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkXG4gICAgICAgICAgfScgaXMgbm90IGEgdmFsaWQgdHlwZS4gVmFsdWUgaXMgb2YgdHlwZSAnJHt0eXBlb2YgZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZX0gYW5kIGlzIG5vdCBhIG51bWJlci4nYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoXG4gICAgICBmaWx0ZXJFeHByZXNzaW9uIGluc3RhbmNlb2YgRi5WZWN0b3JGaWx0ZXJMZXNzVGhhbk9yRXF1YWxFeHByZXNzaW9uXG4gICAgKSB7XG4gICAgICBpZiAodHlwZW9mIGZpbHRlckV4cHJlc3Npb24uVmFsdWUgPT09ICdudW1iZXInKSB7XG4gICAgICAgIGlmIChOdW1iZXIuaXNJbnRlZ2VyKGZpbHRlckV4cHJlc3Npb24uVmFsdWUpKSB7XG4gICAgICAgICAgcmV0dXJuIG5ldyB2ZWN0b3JpbmRleC5fRmlsdGVyRXhwcmVzc2lvbih7XG4gICAgICAgICAgICBsZXNzX3RoYW5fb3JfZXF1YWxfZXhwcmVzc2lvbjpcbiAgICAgICAgICAgICAgbmV3IHZlY3RvcmluZGV4Ll9MZXNzVGhhbk9yRXF1YWxFeHByZXNzaW9uKHtcbiAgICAgICAgICAgICAgICBmaWVsZDogZmlsdGVyRXhwcmVzc2lvbi5GaWVsZCxcbiAgICAgICAgICAgICAgICBpbnRlZ2VyX3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICAgIGxlc3NfdGhhbl9vcl9lcXVhbF9leHByZXNzaW9uOlxuICAgICAgICAgICAgICBuZXcgdmVjdG9yaW5kZXguX0xlc3NUaGFuT3JFcXVhbEV4cHJlc3Npb24oe1xuICAgICAgICAgICAgICAgIGZpZWxkOiBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkLFxuICAgICAgICAgICAgICAgIGZsb2F0X3ZhbHVlOiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlLFxuICAgICAgICAgICAgICB9KSxcbiAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhyb3cgbmV3IEludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAgIGBGaWx0ZXIgdmFsdWUgZm9yIGZpZWxkICcke1xuICAgICAgICAgICAgZmlsdGVyRXhwcmVzc2lvbi5GaWVsZFxuICAgICAgICAgIH0nIGlzIG5vdCBhIHZhbGlkIHR5cGUuIFZhbHVlIGlzIG9mIHR5cGUgJyR7dHlwZW9mIGZpbHRlckV4cHJlc3Npb24uVmFsdWV9IGFuZCBpcyBub3QgYSBudW1iZXIuJ2BcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9IGVsc2UgaWYgKFxuICAgICAgZmlsdGVyRXhwcmVzc2lvbiBpbnN0YW5jZW9mIEYuVmVjdG9yRmlsdGVyTGlzdENvbnRhaW5zRXhwcmVzc2lvblxuICAgICkge1xuICAgICAgaWYgKHR5cGVvZiBmaWx0ZXJFeHByZXNzaW9uLlZhbHVlID09PSAnc3RyaW5nJykge1xuICAgICAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgICAgICBsaXN0X2NvbnRhaW5zX2V4cHJlc3Npb246IG5ldyB2ZWN0b3JpbmRleC5fTGlzdENvbnRhaW5zRXhwcmVzc2lvbih7XG4gICAgICAgICAgICBmaWVsZDogZmlsdGVyRXhwcmVzc2lvbi5GaWVsZCxcbiAgICAgICAgICAgIHN0cmluZ192YWx1ZTogZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZSxcbiAgICAgICAgICB9KSxcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50RXJyb3IoXG4gICAgICAgICAgYEZpbHRlciB2YWx1ZSBmb3IgZmllbGQgJyR7XG4gICAgICAgICAgICBmaWx0ZXJFeHByZXNzaW9uLkZpZWxkXG4gICAgICAgICAgfScgaXMgbm90IGEgdmFsaWQgdHlwZS4gVmFsdWUgaXMgb2YgdHlwZSAnJHt0eXBlb2YgZmlsdGVyRXhwcmVzc2lvbi5WYWx1ZX0gYW5kIGlzIG5vdCBhIHN0cmluZy4nYFxuICAgICAgICApO1xuICAgICAgfVxuICAgIH0gZWxzZSBpZiAoZmlsdGVyRXhwcmVzc2lvbiBpbnN0YW5jZW9mIEYuVmVjdG9yRmlsdGVySWRJblNldEV4cHJlc3Npb24pIHtcbiAgICAgIHJldHVybiBuZXcgdmVjdG9yaW5kZXguX0ZpbHRlckV4cHJlc3Npb24oe1xuICAgICAgICBpZF9pbl9zZXRfZXhwcmVzc2lvbjogbmV3IHZlY3RvcmluZGV4Ll9JZEluU2V0RXhwcmVzc2lvbih7XG4gICAgICAgICAgaWRzOiBmaWx0ZXJFeHByZXNzaW9uLklkcyxcbiAgICAgICAgfSksXG4gICAgICB9KTtcbiAgICB9XG5cbiAgICB0aHJvdyBuZXcgSW52YWxpZEFyZ3VtZW50RXJyb3IoJ0ZpbHRlciBleHByZXNzaW9uIGlzIG5vdCBhIHZhbGlkIHR5cGUuJyk7XG4gIH1cblxuICAvKipcbiAgICogQ29udmVydCBhIGxpc3Qgb2YgaWRzIHRvIGEgZmlsdGVyIGV4cHJlc3Npb24gdGhhdCBtYXRjaGVzIHRoZSBpZHMuXG4gICAqIEBwYXJhbSBpZHNcbiAgICogQHByaXZhdGVcbiAgICovXG4gIHByaXZhdGUgc3RhdGljIGlkc1RvRmlsdGVyRXhwcmVzc2lvbihcbiAgICBpZHM6IHN0cmluZ1tdXG4gICk6IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uIHtcbiAgICByZXR1cm4gbmV3IHZlY3RvcmluZGV4Ll9GaWx0ZXJFeHByZXNzaW9uKHtcbiAgICAgIGlkX2luX3NldF9leHByZXNzaW9uOiBuZXcgdmVjdG9yaW5kZXguX0lkSW5TZXRFeHByZXNzaW9uKHtcbiAgICAgICAgaWRzOiBpZHMsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIHByaXZhdGUgc3RhdGljIGRlc2VyaWFsaXplTWV0YWRhdGEoXG4gICAgbWV0YWRhdGE6IHZlY3RvcmluZGV4Ll9NZXRhZGF0YVtdLFxuICAgIGVycm9yQ2FsbGJhY2s6ICgpID0+IHZvaWRcbiAgKTogVmVjdG9ySW5kZXhNZXRhZGF0YSB7XG4gICAgcmV0dXJuIG1ldGFkYXRhLnJlZHVjZSgoYWNjLCBtZXRhZGF0YSkgPT4ge1xuICAgICAgY29uc3QgZmllbGQgPSBtZXRhZGF0YS5maWVsZDtcbiAgICAgIHN3aXRjaCAobWV0YWRhdGEudmFsdWUpIHtcbiAgICAgICAgY2FzZSAnc3RyaW5nX3ZhbHVlJzpcbiAgICAgICAgICBhY2NbZmllbGRdID0gbWV0YWRhdGEuc3RyaW5nX3ZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdpbnRlZ2VyX3ZhbHVlJzpcbiAgICAgICAgICBhY2NbZmllbGRdID0gbWV0YWRhdGEuaW50ZWdlcl92YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnZG91YmxlX3ZhbHVlJzpcbiAgICAgICAgICBhY2NbZmllbGRdID0gbWV0YWRhdGEuZG91YmxlX3ZhbHVlO1xuICAgICAgICAgIGJyZWFrO1xuICAgICAgICBjYXNlICdib29sZWFuX3ZhbHVlJzpcbiAgICAgICAgICBhY2NbZmllbGRdID0gbWV0YWRhdGEuYm9vbGVhbl92YWx1ZTtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgY2FzZSAnbGlzdF9vZl9zdHJpbmdzX3ZhbHVlJzpcbiAgICAgICAgICBhY2NbZmllbGRdID0gbWV0YWRhdGEubGlzdF9vZl9zdHJpbmdzX3ZhbHVlLnZhbHVlcztcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICBlcnJvckNhbGxiYWNrKCk7XG4gICAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgICByZXR1cm4gYWNjO1xuICAgIH0sIHt9IGFzIFZlY3RvckluZGV4TWV0YWRhdGEpO1xuICB9XG5cbiAgcHJpdmF0ZSBhc3luYyBzZW5kU2VhcmNoKFxuICAgIGluZGV4TmFtZTogc3RyaW5nLFxuICAgIHF1ZXJ5VmVjdG9yOiBBcnJheTxudW1iZXI+LFxuICAgIG9wdGlvbnM/OiBTZWFyY2hPcHRpb25zXG4gICk6IFByb21pc2U8VmVjdG9yU2VhcmNoLlJlc3BvbnNlPiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyB2ZWN0b3JpbmRleC5fU2VhcmNoUmVxdWVzdCh7XG4gICAgICBpbmRleF9uYW1lOiBpbmRleE5hbWUsXG4gICAgICBxdWVyeV92ZWN0b3I6IG5ldyB2ZWN0b3JpbmRleC5fVmVjdG9yKHtlbGVtZW50czogcXVlcnlWZWN0b3J9KSxcbiAgICAgIHRvcF9rOiBvcHRpb25zPy50b3BLID8/IFZFQ1RPUl9ERUZBVUxUX1RPUEssXG4gICAgICBtZXRhZGF0YV9maWVsZHM6IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZE1ldGFkYXRhUmVxdWVzdChvcHRpb25zKSxcbiAgICAgIGZpbHRlcjogVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmJ1aWxkRmlsdGVyRXhwcmVzc2lvbihvcHRpb25zPy5maWx0ZXIpLFxuICAgIH0pO1xuICAgIFZlY3RvckluZGV4RGF0YUNsaWVudC5hcHBseVNjb3JlVGhyZXNob2xkKHJlcXVlc3QsIG9wdGlvbnMpO1xuXG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY2xpZW50LlNlYXJjaChcbiAgICAgICAgcmVxdWVzdCxcbiAgICAgICAge2ludGVyY2VwdG9yczogdGhpcy5pbnRlcmNlcHRvcnN9LFxuICAgICAgICAoZXJyLCByZXNwKSA9PiB7XG4gICAgICAgICAgaWYgKHJlc3ApIHtcbiAgICAgICAgICAgIHJlc29sdmUoXG4gICAgICAgICAgICAgIG5ldyBWZWN0b3JTZWFyY2guU3VjY2VzcyhcbiAgICAgICAgICAgICAgICByZXNwLmhpdHMubWFwKGhpdCA9PiAoe1xuICAgICAgICAgICAgICAgICAgaWQ6IGhpdC5pZCxcbiAgICAgICAgICAgICAgICAgIHNjb3JlOiBoaXQuc2NvcmUsXG4gICAgICAgICAgICAgICAgICBtZXRhZGF0YTogVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmRlc2VyaWFsaXplTWV0YWRhdGEoXG4gICAgICAgICAgICAgICAgICAgIGhpdC5tZXRhZGF0YSxcbiAgICAgICAgICAgICAgICAgICAgKCkgPT5cbiAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFZlY3RvclNlYXJjaC5FcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFVua25vd25FcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAnU2VhcmNoIHJlc3BvbmRlZCB3aXRoIGFuIHVua25vd24gcmVzdWx0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgKSxcbiAgICAgICAgICAgICAgICB9KSlcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXNvbHZlT3JSZWplY3RFcnJvcih7XG4gICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlRmFjdG9yeUZuOiBlID0+IG5ldyBWZWN0b3JTZWFyY2guRXJyb3IoZSksXG4gICAgICAgICAgICAgIHJlc29sdmVGbjogcmVzb2x2ZSxcbiAgICAgICAgICAgICAgcmVqZWN0Rm46IHJlamVjdCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBzZWFyY2hBbmRGZXRjaFZlY3RvcnMoXG4gICAgaW5kZXhOYW1lOiBzdHJpbmcsXG4gICAgcXVlcnlWZWN0b3I6IEFycmF5PG51bWJlcj4sXG4gICAgb3B0aW9ucz86IFNlYXJjaE9wdGlvbnNcbiAgKTogUHJvbWlzZTxWZWN0b3JTZWFyY2hBbmRGZXRjaFZlY3RvcnMuUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgdmFsaWRhdGVJbmRleE5hbWUoaW5kZXhOYW1lKTtcbiAgICAgIGlmIChvcHRpb25zPy50b3BLICE9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgdmFsaWRhdGVUb3BLKG9wdGlvbnMudG9wSyk7XG4gICAgICB9XG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZXR1cm4gdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXR1cm5PclRocm93RXJyb3IoXG4gICAgICAgIGVyciBhcyBFcnJvcixcbiAgICAgICAgZXJyID0+IG5ldyBWZWN0b3JTZWFyY2hBbmRGZXRjaFZlY3RvcnMuRXJyb3IoZXJyKVxuICAgICAgKTtcbiAgICB9XG4gICAgcmV0dXJuIGF3YWl0IHRoaXMuc2VuZFNlYXJjaEFuZEZldGNoVmVjdG9ycyhcbiAgICAgIGluZGV4TmFtZSxcbiAgICAgIHF1ZXJ5VmVjdG9yLFxuICAgICAgb3B0aW9uc1xuICAgICk7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNlbmRTZWFyY2hBbmRGZXRjaFZlY3RvcnMoXG4gICAgaW5kZXhOYW1lOiBzdHJpbmcsXG4gICAgcXVlcnlWZWN0b3I6IEFycmF5PG51bWJlcj4sXG4gICAgb3B0aW9ucz86IFNlYXJjaE9wdGlvbnNcbiAgKTogUHJvbWlzZTxWZWN0b3JTZWFyY2hBbmRGZXRjaFZlY3RvcnMuUmVzcG9uc2U+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IHZlY3RvcmluZGV4Ll9TZWFyY2hBbmRGZXRjaFZlY3RvcnNSZXF1ZXN0KHtcbiAgICAgIGluZGV4X25hbWU6IGluZGV4TmFtZSxcbiAgICAgIHF1ZXJ5X3ZlY3RvcjogbmV3IHZlY3RvcmluZGV4Ll9WZWN0b3Ioe2VsZW1lbnRzOiBxdWVyeVZlY3Rvcn0pLFxuICAgICAgdG9wX2s6IG9wdGlvbnM/LnRvcEsgPz8gVkVDVE9SX0RFRkFVTFRfVE9QSyxcbiAgICAgIG1ldGFkYXRhX2ZpZWxkczogVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmJ1aWxkTWV0YWRhdGFSZXF1ZXN0KG9wdGlvbnMpLFxuICAgICAgZmlsdGVyOiBWZWN0b3JJbmRleERhdGFDbGllbnQuYnVpbGRGaWx0ZXJFeHByZXNzaW9uKG9wdGlvbnM/LmZpbHRlciksXG4gICAgfSk7XG4gICAgVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmFwcGx5U2NvcmVUaHJlc2hvbGQocmVxdWVzdCwgb3B0aW9ucyk7XG5cbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuU2VhcmNoQW5kRmV0Y2hWZWN0b3JzKFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICB7aW50ZXJjZXB0b3JzOiB0aGlzLmludGVyY2VwdG9yc30sXG4gICAgICAgIChlcnIsIHJlc3ApID0+IHtcbiAgICAgICAgICBpZiAocmVzcCkge1xuICAgICAgICAgICAgcmVzb2x2ZShcbiAgICAgICAgICAgICAgbmV3IFZlY3RvclNlYXJjaEFuZEZldGNoVmVjdG9ycy5TdWNjZXNzKFxuICAgICAgICAgICAgICAgIHJlc3AuaGl0cy5tYXAoaGl0ID0+ICh7XG4gICAgICAgICAgICAgICAgICBpZDogaGl0LmlkLFxuICAgICAgICAgICAgICAgICAgc2NvcmU6IGhpdC5zY29yZSxcbiAgICAgICAgICAgICAgICAgIHZlY3RvcjogaGl0LnZlY3Rvci5lbGVtZW50cyxcbiAgICAgICAgICAgICAgICAgIG1ldGFkYXRhOiBWZWN0b3JJbmRleERhdGFDbGllbnQuZGVzZXJpYWxpemVNZXRhZGF0YShcbiAgICAgICAgICAgICAgICAgICAgaGl0Lm1ldGFkYXRhLFxuICAgICAgICAgICAgICAgICAgICAoKSA9PlxuICAgICAgICAgICAgICAgICAgICAgIHJlc29sdmUoXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yU2VhcmNoQW5kRmV0Y2hWZWN0b3JzLkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVW5rbm93bkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICdTZWFyY2hBbmRGZXRjaFZlY3RvcnMgcmVzcG9uZGVkIHdpdGggYW4gdW5rbm93biByZXN1bHQnXG4gICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgIH0pKVxuICAgICAgICAgICAgICApXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICB0aGlzLmNhY2hlU2VydmljZUVycm9yTWFwcGVyLnJlc29sdmVPclJlamVjdEVycm9yKHtcbiAgICAgICAgICAgICAgZXJyOiBlcnIsXG4gICAgICAgICAgICAgIGVycm9yUmVzcG9uc2VGYWN0b3J5Rm46IGUgPT5cbiAgICAgICAgICAgICAgICBuZXcgVmVjdG9yU2VhcmNoQW5kRmV0Y2hWZWN0b3JzLkVycm9yKGUpLFxuICAgICAgICAgICAgICByZXNvbHZlRm46IHJlc29sdmUsXG4gICAgICAgICAgICAgIHJlamVjdEZuOiByZWplY3QsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICk7XG4gICAgfSk7XG4gIH1cblxuICBwdWJsaWMgYXN5bmMgZ2V0SXRlbUJhdGNoKFxuICAgIGluZGV4TmFtZTogc3RyaW5nLFxuICAgIGZpbHRlcjogc3RyaW5nW11cbiAgKTogUHJvbWlzZTxWZWN0b3JHZXRJdGVtQmF0Y2guUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgdmFsaWRhdGVJbmRleE5hbWUoaW5kZXhOYW1lKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB0aGlzLmNhY2hlU2VydmljZUVycm9yTWFwcGVyLnJldHVybk9yVGhyb3dFcnJvcihcbiAgICAgICAgZXJyIGFzIEVycm9yLFxuICAgICAgICBlcnIgPT4gbmV3IFZlY3RvckdldEl0ZW1CYXRjaC5FcnJvcihlcnIpXG4gICAgICApO1xuICAgIH1cbiAgICByZXR1cm4gYXdhaXQgdGhpcy5zZW5kR2V0SXRlbUJhdGNoKGluZGV4TmFtZSwgZmlsdGVyKTtcbiAgfVxuXG4gIHByaXZhdGUgYXN5bmMgc2VuZEdldEl0ZW1CYXRjaChcbiAgICBpbmRleE5hbWU6IHN0cmluZyxcbiAgICBmaWx0ZXI6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8VmVjdG9yR2V0SXRlbUJhdGNoLlJlc3BvbnNlPiB7XG4gICAgY29uc3QgcmVxdWVzdCA9IG5ldyB2ZWN0b3JpbmRleC5fR2V0SXRlbUJhdGNoUmVxdWVzdCh7XG4gICAgICBpbmRleF9uYW1lOiBpbmRleE5hbWUsXG4gICAgICBmaWx0ZXI6IFZlY3RvckluZGV4RGF0YUNsaWVudC5pZHNUb0ZpbHRlckV4cHJlc3Npb24oZmlsdGVyKSxcbiAgICAgIG1ldGFkYXRhX2ZpZWxkczogVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmJ1aWxkTWV0YWRhdGFSZXF1ZXN0KHtcbiAgICAgICAgbWV0YWRhdGFGaWVsZHM6IEFMTF9WRUNUT1JfTUVUQURBVEEsXG4gICAgICB9KSxcbiAgICB9KTtcbiAgICByZXR1cm4gYXdhaXQgbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4ge1xuICAgICAgdGhpcy5jbGllbnQuR2V0SXRlbUJhdGNoKFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICB7aW50ZXJjZXB0b3JzOiB0aGlzLmludGVyY2VwdG9yc30sXG4gICAgICAgIChlcnIsIHJlc3ApID0+IHtcbiAgICAgICAgICBpZiAocmVzcCkge1xuICAgICAgICAgICAgcmVzb2x2ZShcbiAgICAgICAgICAgICAgbmV3IFZlY3RvckdldEl0ZW1CYXRjaC5TdWNjZXNzKFxuICAgICAgICAgICAgICAgIHJlc3AuaXRlbV9yZXNwb25zZS5yZWR1Y2UoKGFjYywgaXRlbVJlc3BvbnNlKSA9PiB7XG4gICAgICAgICAgICAgICAgICBhY2NbaXRlbVJlc3BvbnNlLmlkXSA9IHtcbiAgICAgICAgICAgICAgICAgICAgaWQ6IGl0ZW1SZXNwb25zZS5pZCxcbiAgICAgICAgICAgICAgICAgICAgdmVjdG9yOiBpdGVtUmVzcG9uc2UudmVjdG9yLmVsZW1lbnRzLFxuICAgICAgICAgICAgICAgICAgICBtZXRhZGF0YTogVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmRlc2VyaWFsaXplTWV0YWRhdGEoXG4gICAgICAgICAgICAgICAgICAgICAgaXRlbVJlc3BvbnNlLm1ldGFkYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICgpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yR2V0SXRlbUJhdGNoLkVycm9yKFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ldyBVbmtub3duRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnR2V0SXRlbUJhdGNoIHJlc3BvbmRlZCB3aXRoIGFuIHVua25vd24gcmVzdWx0J1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgICAgICAgICApLFxuICAgICAgICAgICAgICAgICAgfTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgVmVjdG9ySW5kZXhTdG9yZWRJdGVtPilcbiAgICAgICAgICAgICAgKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgdGhpcy5jYWNoZVNlcnZpY2VFcnJvck1hcHBlci5yZXNvbHZlT3JSZWplY3RFcnJvcih7XG4gICAgICAgICAgICAgIGVycjogZXJyLFxuICAgICAgICAgICAgICBlcnJvclJlc3BvbnNlRmFjdG9yeUZuOiBlID0+IG5ldyBWZWN0b3JHZXRJdGVtQmF0Y2guRXJyb3IoZSksXG4gICAgICAgICAgICAgIHJlc29sdmVGbjogcmVzb2x2ZSxcbiAgICAgICAgICAgICAgcmVqZWN0Rm46IHJlamVjdCxcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIHB1YmxpYyBhc3luYyBnZXRJdGVtTWV0YWRhdGFCYXRjaChcbiAgICBpbmRleE5hbWU6IHN0cmluZyxcbiAgICBmaWx0ZXI6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8VmVjdG9yR2V0SXRlbU1ldGFkYXRhQmF0Y2guUmVzcG9uc2U+IHtcbiAgICB0cnkge1xuICAgICAgdmFsaWRhdGVJbmRleE5hbWUoaW5kZXhOYW1lKTtcbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJldHVybiB0aGlzLmNhY2hlU2VydmljZUVycm9yTWFwcGVyLnJldHVybk9yVGhyb3dFcnJvcihcbiAgICAgICAgZXJyIGFzIEVycm9yLFxuICAgICAgICBlcnIgPT4gbmV3IFZlY3RvckdldEl0ZW1NZXRhZGF0YUJhdGNoLkVycm9yKGVycilcbiAgICAgICk7XG4gICAgfVxuICAgIHJldHVybiBhd2FpdCB0aGlzLnNlbmRHZXRJdGVtTWV0YWRhdGFCYXRjaChpbmRleE5hbWUsIGZpbHRlcik7XG4gIH1cblxuICBwcml2YXRlIGFzeW5jIHNlbmRHZXRJdGVtTWV0YWRhdGFCYXRjaChcbiAgICBpbmRleE5hbWU6IHN0cmluZyxcbiAgICBmaWx0ZXI6IHN0cmluZ1tdXG4gICk6IFByb21pc2U8VmVjdG9yR2V0SXRlbU1ldGFkYXRhQmF0Y2guUmVzcG9uc2U+IHtcbiAgICBjb25zdCByZXF1ZXN0ID0gbmV3IHZlY3RvcmluZGV4Ll9HZXRJdGVtTWV0YWRhdGFCYXRjaFJlcXVlc3Qoe1xuICAgICAgaW5kZXhfbmFtZTogaW5kZXhOYW1lLFxuICAgICAgZmlsdGVyOiBWZWN0b3JJbmRleERhdGFDbGllbnQuaWRzVG9GaWx0ZXJFeHByZXNzaW9uKGZpbHRlciksXG4gICAgICBtZXRhZGF0YV9maWVsZHM6IFZlY3RvckluZGV4RGF0YUNsaWVudC5idWlsZE1ldGFkYXRhUmVxdWVzdCh7XG4gICAgICAgIG1ldGFkYXRhRmllbGRzOiBBTExfVkVDVE9SX01FVEFEQVRBLFxuICAgICAgfSksXG4gICAgfSk7XG4gICAgcmV0dXJuIGF3YWl0IG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0+IHtcbiAgICAgIHRoaXMuY2xpZW50LkdldEl0ZW1NZXRhZGF0YUJhdGNoKFxuICAgICAgICByZXF1ZXN0LFxuICAgICAgICB7aW50ZXJjZXB0b3JzOiB0aGlzLmludGVyY2VwdG9yc30sXG4gICAgICAgIChlcnIsIHJlc3ApID0+IHtcbiAgICAgICAgICBpZiAocmVzcCkge1xuICAgICAgICAgICAgcmVzb2x2ZShcbiAgICAgICAgICAgICAgbmV3IFZlY3RvckdldEl0ZW1NZXRhZGF0YUJhdGNoLlN1Y2Nlc3MoXG4gICAgICAgICAgICAgICAgcmVzcC5pdGVtX21ldGFkYXRhX3Jlc3BvbnNlLnJlZHVjZSgoYWNjLCBpdGVtUmVzcG9uc2UpID0+IHtcbiAgICAgICAgICAgICAgICAgIGFjY1tpdGVtUmVzcG9uc2UuaWRdID1cbiAgICAgICAgICAgICAgICAgICAgVmVjdG9ySW5kZXhEYXRhQ2xpZW50LmRlc2VyaWFsaXplTWV0YWRhdGEoXG4gICAgICAgICAgICAgICAgICAgICAgaXRlbVJlc3BvbnNlLm1ldGFkYXRhLFxuICAgICAgICAgICAgICAgICAgICAgICgpID0+XG4gICAgICAgICAgICAgICAgICAgICAgICByZXNvbHZlKFxuICAgICAgICAgICAgICAgICAgICAgICAgICBuZXcgVmVjdG9yR2V0SXRlbU1ldGFkYXRhQmF0Y2guRXJyb3IoXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgbmV3IFVua25vd25FcnJvcihcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdHZXRJdGVtTWV0YWRhdGFCYXRjaCByZXNwb25kZWQgd2l0aCBhbiB1bmtub3duIHJlc3VsdCdcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICApXG4gICAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgICAgIClcbiAgICAgICAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBhY2M7XG4gICAgICAgICAgICAgICAgfSwge30gYXMgUmVjb3JkPHN0cmluZywgVmVjdG9ySW5kZXhNZXRhZGF0YT4pXG4gICAgICAgICAgICAgIClcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuY2FjaGVTZXJ2aWNlRXJyb3JNYXBwZXIucmVzb2x2ZU9yUmVqZWN0RXJyb3Ioe1xuICAgICAgICAgICAgICBlcnI6IGVycixcbiAgICAgICAgICAgICAgZXJyb3JSZXNwb25zZUZhY3RvcnlGbjogZSA9PlxuICAgICAgICAgICAgICAgIG5ldyBWZWN0b3JHZXRJdGVtTWV0YWRhdGFCYXRjaC5FcnJvcihlKSxcbiAgICAgICAgICAgICAgcmVzb2x2ZUZuOiByZXNvbHZlLFxuICAgICAgICAgICAgICByZWplY3RGbjogcmVqZWN0LFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuICB9XG5cbiAgcHJpdmF0ZSB2YWxpZGF0ZVJlcXVlc3RUaW1lb3V0KHRpbWVvdXQ/OiBudW1iZXIpIHtcbiAgICB0aGlzLmxvZ2dlci5kZWJ1ZyhgUmVxdWVzdCB0aW1lb3V0IG1zOiAke1N0cmluZyh0aW1lb3V0KX1gKTtcbiAgICBpZiAodGltZW91dCAhPT0gdW5kZWZpbmVkICYmIHRpbWVvdXQgPD0gMCkge1xuICAgICAgdGhyb3cgbmV3IEludmFsaWRBcmd1bWVudEVycm9yKFxuICAgICAgICAncmVxdWVzdCB0aW1lb3V0IG11c3QgYmUgZ3JlYXRlciB0aGFuIHplcm8uJ1xuICAgICAgKTtcbiAgICB9XG4gIH1cblxuICBwcml2YXRlIGluaXRpYWxpemVJbnRlcmNlcHRvcnMoXG4gICAgX2xvZ2dlckZhY3Rvcnk6IE1vbWVudG9Mb2dnZXJGYWN0b3J5XG4gICk6IEludGVyY2VwdG9yW10ge1xuICAgIGNvbnN0IGhlYWRlcnMgPSBbXG4gICAgICBuZXcgSGVhZGVyKCdBdXRob3JpemF0aW9uJywgdGhpcy5jcmVkZW50aWFsUHJvdmlkZXIuZ2V0QXV0aFRva2VuKCkpLFxuICAgICAgbmV3IEhlYWRlcignQWdlbnQnLCBgbm9kZWpzOiR7dmVyc2lvbn1gKSxcbiAgICBdO1xuICAgIHJldHVybiBbXG4gICAgICBuZXcgSGVhZGVySW50ZXJjZXB0b3JQcm92aWRlcihoZWFkZXJzKS5jcmVhdGVIZWFkZXJzSW50ZXJjZXB0b3IoKSxcbiAgICAgIENsaWVudFRpbWVvdXRJbnRlcmNlcHRvcih0aGlzLnJlcXVlc3RUaW1lb3V0TXMpLFxuICAgIF07XG4gIH1cbn1cbiJdfQ==