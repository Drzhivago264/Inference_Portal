"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "PDFReader", {
    enumerable: true,
    get: function() {
        return PDFReader;
    }
});
const _env = require("@llamaindex/env");
const _Node = require("../Node.js");
class PDFReader {
    async loadData(file, fs = _env.defaultFS) {
        const content = await fs.readRawFile(file);
        const text = await readPDF(content);
        return text.map((text)=>{
            const sha256 = (0, _env.createSHA256)();
            sha256.update(text);
            return new _Node.Document({
                text,
                id_: sha256.digest()
            });
        });
    }
}
async function readPDF(data) {
    const parser = await import("pdf2json").then(({ default: Pdfparser })=>new Pdfparser(null, 1));
    const text = await new Promise((resolve, reject)=>{
        parser.on("pdfParser_dataError", (error)=>{
            reject(error);
        });
        parser.on("pdfParser_dataReady", ()=>{
            resolve(parser.getRawTextContent());
        });
        parser.parseBuffer(data);
    });
    return text.split(/----------------Page \(\d+\) Break----------------/g);
}
