{"version":3,"file":"index.mjs","sources":["../src/storage.ts","../src/langfuse.ts"],"sourcesContent":["import { type LangfuseOptions } from \"./types\";\n\nexport type LangfuseStorage = {\n  getItem: (key: string) => string | null | undefined;\n  setItem: (key: string, value: string) => void;\n  removeItem: (key: string) => void;\n  clear: () => void;\n  getAllKeys: () => readonly string[];\n};\n\n// Methods partially borrowed from quirksmode.org/js/cookies.html\nexport const cookieStore: LangfuseStorage = {\n  getItem(key) {\n    try {\n      const nameEQ = key + \"=\";\n      const ca = document.cookie.split(\";\");\n      for (let i = 0; i < ca.length; i++) {\n        let c = ca[i];\n        while (c.charAt(0) == \" \") {\n          c = c.substring(1, c.length);\n        }\n        if (c.indexOf(nameEQ) === 0) {\n          return decodeURIComponent(c.substring(nameEQ.length, c.length));\n        }\n      }\n    } catch (err) {}\n    return null;\n  },\n\n  setItem(key: string, value: string) {\n    try {\n      const cdomain = \"\",\n        expires = \"\",\n        secure = \"\";\n\n      const new_cookie_val = key + \"=\" + encodeURIComponent(value) + expires + \"; path=/\" + cdomain + secure;\n      document.cookie = new_cookie_val;\n    } catch (err) {\n      return;\n    }\n  },\n\n  removeItem(name) {\n    try {\n      cookieStore.setItem(name, \"\");\n    } catch (err) {\n      return;\n    }\n  },\n  clear() {\n    document.cookie = \"\";\n  },\n  getAllKeys() {\n    const ca = document.cookie.split(\";\");\n    const keys = [];\n\n    for (let i = 0; i < ca.length; i++) {\n      let c = ca[i];\n      while (c.charAt(0) == \" \") {\n        c = c.substring(1, c.length);\n      }\n      keys.push(c.split(\"=\")[0]);\n    }\n\n    return keys;\n  },\n};\n\nconst createStorageLike = (store: any): LangfuseStorage => {\n  return {\n    getItem(key) {\n      return store.getItem(key);\n    },\n\n    setItem(key, value) {\n      store.setItem(key, value);\n    },\n\n    removeItem(key) {\n      store.removeItem(key);\n    },\n    clear() {\n      store.clear();\n    },\n    getAllKeys() {\n      const keys = [];\n      for (const key in localStorage) {\n        keys.push(key);\n      }\n      return keys;\n    },\n  };\n};\n\nconst checkStoreIsSupported = (storage: LangfuseStorage, key = \"__mplssupport__\"): boolean => {\n  if (!window) {\n    return false;\n  }\n  try {\n    const val = \"xyz\";\n    storage.setItem(key, val);\n    if (storage.getItem(key) !== val) {\n      return false;\n    }\n    storage.removeItem(key);\n    return true;\n  } catch (err) {\n    return false;\n  }\n};\n\nlet localStore: LangfuseStorage | undefined = undefined;\nlet sessionStore: LangfuseStorage | undefined = undefined;\n\nconst createMemoryStorage = (): LangfuseStorage => {\n  const _cache: { [key: string]: any | undefined } = {};\n\n  const store: LangfuseStorage = {\n    getItem(key) {\n      return _cache[key];\n    },\n\n    setItem(key, value) {\n      _cache[key] = value !== null ? value : undefined;\n    },\n\n    removeItem(key) {\n      delete _cache[key];\n    },\n    clear() {\n      for (const key in _cache) {\n        delete _cache[key];\n      }\n    },\n    getAllKeys() {\n      const keys = [];\n      for (const key in _cache) {\n        keys.push(key);\n      }\n      return keys;\n    },\n  };\n  return store;\n};\n\nexport const getStorage = (type: LangfuseOptions[\"persistence\"], window: Window | undefined): LangfuseStorage => {\n  if (typeof window !== undefined && window) {\n    if (!localStorage) {\n      const _localStore = createStorageLike(window.localStorage);\n      localStore = checkStoreIsSupported(_localStore) ? _localStore : undefined;\n    }\n\n    if (!sessionStore) {\n      const _sessionStore = createStorageLike(window.sessionStorage);\n      sessionStore = checkStoreIsSupported(_sessionStore) ? _sessionStore : undefined;\n    }\n  }\n\n  switch (type) {\n    case \"cookie\":\n      return cookieStore || localStore || sessionStore || createMemoryStorage();\n    case \"localStorage\":\n      return localStore || sessionStore || createMemoryStorage();\n    case \"sessionStorage\":\n      return sessionStore || createMemoryStorage();\n    case \"memory\":\n      return createMemoryStorage();\n    default:\n      return createMemoryStorage();\n  }\n};\n","import {\n  LangfuseCore,\n  LangfuseWebStateless,\n  type LangfuseFetchOptions,\n  type LangfuseFetchResponse,\n  type LangfusePersistedProperty,\n  utils,\n} from \"langfuse-core\";\nimport { type LangfuseStorage, getStorage } from \"./storage\";\nimport { version } from \"../package.json\";\nimport { type LangfuseOptions } from \"./types\";\n\n// Required when users pass these as typed arguments\nexport {\n  type LangfuseTraceClient,\n  type LangfuseSpanClient,\n  type LangfuseEventClient,\n  type LangfuseGenerationClient,\n} from \"langfuse-core\";\n\nexport class Langfuse extends LangfuseCore {\n  private _storage: LangfuseStorage;\n  private _storageCache: any;\n  private _storageKey: string;\n\n  constructor(params?: { publicKey?: string; secretKey?: string } & LangfuseOptions) {\n    const { publicKey, secretKey, ...options } = utils.configLangfuseSDK(params);\n    if (!secretKey) {\n      throw new Error(\"[Langfuse] secretKey is required for instantiation\");\n    }\n    if (!publicKey) {\n      throw new Error(\"[Langfuse] publicKey is required for instantiation\");\n    }\n\n    super({ publicKey, secretKey, ...options });\n\n    if (typeof window !== \"undefined\" && \"Deno\" in window === false) {\n      this._storageKey = params?.persistence_name ? `lf_${params.persistence_name}` : `lf_${publicKey}_langfuse`;\n      this._storage = getStorage(params?.persistence || \"localStorage\", window);\n    } else {\n      this._storageKey = `lf_${publicKey}_langfuse`;\n      this._storage = getStorage(\"memory\", undefined);\n    }\n  }\n\n  getPersistedProperty<T>(key: LangfusePersistedProperty): T | undefined {\n    if (!this._storageCache) {\n      this._storageCache = JSON.parse(this._storage.getItem(this._storageKey) || \"{}\") || {};\n    }\n\n    return this._storageCache[key];\n  }\n\n  setPersistedProperty<T>(key: LangfusePersistedProperty, value: T | null): void {\n    if (!this._storageCache) {\n      this._storageCache = JSON.parse(this._storage.getItem(this._storageKey) || \"{}\") || {};\n    }\n\n    if (value === null) {\n      delete this._storageCache[key];\n    } else {\n      this._storageCache[key] = value;\n    }\n\n    this._storage.setItem(this._storageKey, JSON.stringify(this._storageCache));\n  }\n\n  fetch(url: string, options: LangfuseFetchOptions): Promise<LangfuseFetchResponse> {\n    return fetch(url, options);\n  }\n\n  getLibraryId(): string {\n    return \"langfuse\";\n  }\n\n  getLibraryVersion(): string {\n    return version;\n  }\n\n  getCustomUserAgent(): void {\n    return;\n  }\n}\n\nexport class LangfuseWeb extends LangfuseWebStateless {\n  private _storage: LangfuseStorage;\n  private _storageCache: any;\n  private _storageKey: string;\n\n  constructor(params?: { publicKey?: string } & LangfuseOptions) {\n    const { publicKey, ...options } = utils.configLangfuseSDK(params, false);\n    if (!publicKey) {\n      throw new Error(\"[Langfuse] publicKey is required for instantiation\");\n    }\n\n    super({ publicKey, ...options });\n\n    if (typeof window !== \"undefined\") {\n      this._storageKey = params?.persistence_name ? `lf_${params.persistence_name}` : `lf_${publicKey}_langfuse`;\n      this._storage = getStorage(params?.persistence || \"localStorage\", window);\n    } else {\n      this._storageKey = `lf_${publicKey}_langfuse`;\n      this._storage = getStorage(\"memory\", undefined);\n    }\n  }\n\n  getPersistedProperty<T>(key: LangfusePersistedProperty): T | undefined {\n    if (!this._storageCache) {\n      this._storageCache = JSON.parse(this._storage.getItem(this._storageKey) || \"{}\") || {};\n    }\n\n    return this._storageCache[key];\n  }\n\n  setPersistedProperty<T>(key: LangfusePersistedProperty, value: T | null): void {\n    if (!this._storageCache) {\n      this._storageCache = JSON.parse(this._storage.getItem(this._storageKey) || \"{}\") || {};\n    }\n\n    if (value === null) {\n      delete this._storageCache[key];\n    } else {\n      this._storageCache[key] = value;\n    }\n\n    this._storage.setItem(this._storageKey, JSON.stringify(this._storageCache));\n  }\n\n  fetch(url: string, options: LangfuseFetchOptions): Promise<LangfuseFetchResponse> {\n    return fetch(url, options);\n  }\n\n  getLibraryId(): string {\n    return \"langfuse-frontend\";\n  }\n\n  getLibraryVersion(): string {\n    return version;\n  }\n\n  getCustomUserAgent(): void {\n    return;\n  }\n}\n"],"names":["cookieStore","getItem","key","nameEQ","ca","document","cookie","split","i","length","c","charAt","substring","indexOf","decodeURIComponent","err","setItem","value","cdomain","expires","secure","new_cookie_val","encodeURIComponent","removeItem","name","clear","getAllKeys","keys","push","createStorageLike","store","localStorage","checkStoreIsSupported","storage","window","val","localStore","undefined","sessionStore","createMemoryStorage","_cache","getStorage","type","_localStore","_sessionStore","sessionStorage","Langfuse","LangfuseCore","constructor","params","publicKey","secretKey","options","utils","configLangfuseSDK","Error","_storageKey","persistence_name","_storage","persistence","getPersistedProperty","_storageCache","JSON","parse","setPersistedProperty","stringify","fetch","url","getLibraryId","getLibraryVersion","version","getCustomUserAgent","LangfuseWeb","LangfuseWebStateless"],"mappings":"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"}